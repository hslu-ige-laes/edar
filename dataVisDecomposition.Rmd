## Decomposition
### Task
tbd

### Basis

* tbd

### Solution


Create a new script, copy/paste the following code and run it:

```{r dataVisDecomposition1, warning=FALSE, message=FALSE, collapse = FALSE}
library(dplyr)
library(lubridate)
library(plotly)
library(ggseas)

# load csv file
df <- read.csv2("https://github.com/hslu-ige-laes/edar/raw/master/sampleData/flatHeatAndHotWater.csv",
                stringsAsFactors=FALSE)

# filter flat
df <- df %>% select(timestamp, Adr02_energyHeat)

colnames(df) <- c("timestamp", "meterValue")

df$timestamp <- parse_date_time(df$timestamp,
                                orders = "YmdHMS",
                                tz = "Europe/Zurich")

# calculate consumption value per month
# pay attention, the value of 2010-02-01 00:00:00 represents the meter reading on february first,
# so the consumption for february first is value(march) - value(february)!
df <- df %>% mutate(value = lead(meterValue) - meterValue)

# remove counter value column
df <- df %>% select(-meterValue)
df[1,2] <- 600

df.ts <- ts(df %>% select(value) %>% na.omit(), frequency = 12, start = min(year(df$timestamp)))

df2 <- ggseas::tsdf(df.ts)
p <- ggsdc(df2,
           aes(x = x, y = y),
           method = "stl",
           s.window = 12,
           facet.titles = c("Original Time Series",
                            "Trend",
                            "Seasonal Pattern",
                            "Randomness")
) + 
  geom_line(color = "darkorange", alpha = 0.7) +
  theme_minimal() +
  theme(panel.spacing = unit(1, "lines"),) +
  labs(x = "") +
  scale_x_continuous(breaks = seq(min(df2$x), max(df2$x),1)) +
  ggtitle("Time Series Decomposition")

ggplotly(p)


```

### Discussion
tbd

### See Also
tbd

