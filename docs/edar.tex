% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{book}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Energy Data Analysis with R},
  pdfauthor={Reto Marek},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs}
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{booktabs}
\usepackage{amsthm}
\makeatletter
\def\thm@space@setup{%
  \thm@preskip=8pt plus 2pt minus 4pt
  \thm@postskip=\thm@preskip
}
\makeatother

%% change fontsize of R code
\let\oldShaded\Shaded
\let\endoldShaded\endShaded
\renewenvironment{Shaded}{\footnotesize\oldShaded}{\endoldShaded}

%% change fontsize of output
\let\oldverbatim\verbatim
\let\endoldverbatim\endverbatim
\renewenvironment{verbatim}{\footnotesize\oldverbatim}{\endoldverbatim}
\usepackage[]{natbib}
\bibliographystyle{apalike}

\title{Energy Data Analysis with R}
\author{Reto Marek}
\date{2020-11-21}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{intro}{%
\chapter{Introduction}\label{intro}}

Preface

This book gives you an overview of the statistical software R and its ability to analyze and visualize time series in the context of building energy and comfort.

It is aimed at R beginners as well as exerienced R users and is strongly inspired by the R Graphics Cookbook and Engineering Data Analysis in R. The aim of this book is to provide additional specific recipes for energy and comfort related tasks and to make your entry into R smooth and easy.

\hypertarget{content}{%
\section{Content}\label{content}}

The book is independently structured and a beginner gets information on how to install the program environment and gets a quick practical introduction.

The examples in this book will show you how to complete certain specific tasks. Examples are shown so that you can understand the basic principle and reproduce the analysis or visualization with your own data. Simply copy the code into your R-script, replace the sample data files with your own and execute the code.

This book was developed using Yihui Xie's bookdown framework. The book is built using code that combines R code, data, and text to create a book for which R code and examples can be re-executed every time the book is re-built.
The online book is hosted using GitHub's free GitHub Pages. All material for this book is available and can be explored at the book's GitHub repository.

\hypertarget{why-r-and-rstudio}{%
\section{Why R and RStudio?}\label{why-r-and-rstudio}}

In a study commissioned by the Swiss Federal Office of Energy, experts from the field were asked how and where they perform energy analyses and create visualizations. The result was that many people today either need Excel or use a building monitoring software to execute analysis and create visualizations. Excel users are pushing the program to its limits with the ever-increasing data sets. Also the interactive ability of the graphics there is limited. The change to an environment like ``R'' seems to be difficult for many. In the market there are numerous books which make the change to ``R'' for other disciplines easier. However, experts from the energy and building services engineering industry lack a corresponding work. The present book is intended to close this gap.

The freely available programming language ``R'' and its graphical user interface ``RStudio'' offer many more possibilities for data analysis and data visualization.

\hypertarget{other-useful-sources}{%
\section{Other useful sources}\label{other-useful-sources}}

A really good source is R for Data Science by Garrett Grolemund and Hadley Wickham. The entire book is freely available online through the same format of this book.

There are a number of other useful books available on general R programming, including:

\begin{itemize}
\tightlist
\item
  R Graphics Cookbook
\item
  Introduction to Data Science - Data Analysis and Prediction Algorithms with R
\item
  Hands-On Programming with R
\item
  Engineering Data Analysis in R
\end{itemize}

\hypertarget{getting-started}{%
\chapter{Getting started}\label{getting-started}}

\hypertarget{installation}{%
\section{Install R and R Studio}\label{installation}}

Before we can start the first analysis, we have to install ``R'' and ``RStudio''. This may seem laborious, but it is necessary and easier than it appears at first glance.

\begin{itemize}
\tightlist
\item
  ``R'' is a programming language used for statistical computing while ``RStudio'' provides a graphical user interface
\item
  ``R'' may be used without ``RStudio'', but ``RStudio'' may not be used without ``R''
\item
  Both, ``R'' and ``RStudio'' are free of charge and there are no licencse fees
\item
  When you later make an analysis and visualizations, you only work in the graphical user interface ``RStudio''
\end{itemize}

\hypertarget{download-and-install-r}{%
\subsection{Download and Install R}\label{download-and-install-r}}

\hypertarget{windows}{%
\subsubsection{Windows}\label{windows}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Open https://cran.r-project.org/bin/windows/base/ and press the link ``Download R\ldots{}''
\item
  Run the downloaded installer file and follow the installation wizard
\end{enumerate}

The wizard will install ``R'' into your \texttt{Program\ Files} folders and adds a shortcut in your Start menu. Note that you will need to have all necessary administration rights to install new software on your machine.

\hypertarget{mac-osx}{%
\subsubsection{Mac OSX}\label{mac-osx}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Open https://cran.r-project.org/bin/macosx/ and download the latest \texttt{*.pkg} file
\item
  Run the downloaded installer file and follow the installation wizard
\end{enumerate}

The installer allows you to customize your installation. However the default values will be suitable for most users.

\hypertarget{linux}{%
\subsubsection{Linux}\label{linux}}

``R'' is part of many Linux distributions, therefore you should check with your Linux package management system if it's already installed.

The CRAN website provides files to build ``R'' from source on Debian, Redhat, SUSE, and Ubuntu systems under the link ``Download R for Linux''

\begin{itemize}
\tightlist
\item
  Open https://cran.r-project.org/bin/linux/ and then follow the directory trail to the version of Linux you wish to install R on top of
\end{itemize}

The exact installation procedure will vary depending on your Linux operating system. CRAN supports the process by grouping each set of source files with documentation or README files that explain how to install on your system.

\hypertarget{download-and-install-rstudio}{%
\subsection{Download and Install RStudio}\label{download-and-install-rstudio}}

``R Studio'' is a development environment for ``R''.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Open https://rstudio.com/products/rstudio/download/ and download ``RStudio Desktop Open Source''
\item
  Follow the on-screen instructions
\item
  Once you have installed ``R Studio'', you can run it like any other application by clicking the program icon
\end{enumerate}

\hypertarget{install-required-packages}{%
\section{Install required packages}\label{install-required-packages}}

Appendix \ref{packages} gives you an introduction to what a package is and how to install it. Below are the packages used in this book and it is recommended to install them now.

\begin{itemize}
\tightlist
\item
  Open ``RStudio'' just as you would any program, by clicking on its icon
\item
  Copy the following code and paste it into your console (on the bottom left, right of the symbol \texttt{\textgreater{}}):
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"devtools"}\NormalTok{, }\StringTok{"tidyverse"}\NormalTok{, }\StringTok{"plotly"}\NormalTok{, }\StringTok{"lubridate"}\NormalTok{, }\StringTok{"r2d3"}\NormalTok{, }\StringTok{"checkmate"}\NormalTok{)}
\KeywordTok{install_github}\NormalTok{(}\StringTok{"hslu-ige-laes/redutils"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Press \texttt{Enter} or \texttt{Return}
\end{itemize}

The installation of the packages is now in progress and this may take a while, please be patient. In the meantime you can read in appendix \ref{packages} what packages are in general and how they can be installed and later loaded into scripts.

\hypertarget{create-an-r-script}{%
\section{Create an R Script}\label{create-an-r-script}}

Finally, you have installed ``R'' and ``RStudio'' with the first set of packages on your computer.

Let's create the first visualization.
- Open ``RStudio'' just as you would any program, by clicking on its icon
- Go to the menu on the top left and click to \texttt{File\ /\ New\ File\ /\ R\ Script}
- Copy the following code and paste it into your script:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(graphics)}
\KeywordTok{plot}\NormalTok{(co2, }\DataTypeTok{ylab =} \StringTok{"CO2 (ppm)"}\NormalTok{, }\DataTypeTok{las =} \DecValTok{1}\NormalTok{)}
\KeywordTok{title}\NormalTok{(}\DataTypeTok{main =} \StringTok{"Mauna Loa Atmospheric CO2 Concentration"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  select all by pressing \texttt{Ctrl\ +\ A}
\item
  Thren run the code by pressing the \texttt{Run} Button or \texttt{Ctrl\ +\ Enter}
\end{itemize}

You should now get your first visualization:

\includegraphics{edar_files/figure-latex/co2 intro graph-1.pdf}

As you probably noticed, we did not load any data. The basic installation of ``R'' and some packages come with test data. So that is an easy way to test something. The R Dataset Package provides some preinstalled datasets, including the used ``Mauna Loa Atmospheric CO2 Concentration'' dataset.

\hypertarget{whats-next}{%
\section{What's next?}\label{whats-next}}

Now hopefully, everything has worked fine so far with the installation and your first visualization.
Congratulations! You have now a running R environment and we can start with more interesting stuff.

The following chapters will give you an overview

\hypertarget{r-basics}{%
\chapter{R Basics}\label{r-basics}}

\hypertarget{loading-data}{%
\section{Loading Data}\label{loading-data}}

\hypertarget{csv-file}{%
\subsection{Csv File}\label{csv-file}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"datafile.csv"}\NormalTok{)}
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"datafile.csv"}\NormalTok{, }\DataTypeTok{header=}\OtherTok{FALSE}\NormalTok{, }\DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"https://github.com/retomarek/r/raw/master/datasets/buildingMonitoringTestDataSet.csv"}\NormalTok{,}
               \DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{,}
               \DataTypeTok{sep =}\StringTok{","}\NormalTok{,}
               \DataTypeTok{na.strings =} \KeywordTok{c}\NormalTok{(}\StringTok{""}\NormalTok{, }\StringTok{"NA"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

Attention: By default, strings in the data are treated as factors.
read.csv() is a convenience wrapper function around read.table(). If you need more control over the input, see ?read.table

\hypertarget{excel-file}{%
\subsection{Excel File}\label{excel-file}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Only need to install once}
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"xlsx"}\NormalTok{)}

\KeywordTok{library}\NormalTok{(xslx)}

\NormalTok{df <-}\StringTok{ }\KeywordTok{read.xlsx}\NormalTok{(}\StringTok{"datafile.xlsx"}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.xlsx}\NormalTok{(}\StringTok{"datafile.xls"}\NormalTok{, }\DataTypeTok{sheetIndex=}\DecValTok{2}\NormalTok{)}
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.xlsx}\NormalTok{(}\StringTok{"datafile.xls"}\NormalTok{, }\DataTypeTok{sheetName=}\StringTok{"Revenues"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

For reading older Excel files in the .xls format, the gdata package has the function read.xls():

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Only need to install once}
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"gdata"}\NormalTok{)}

\KeywordTok{library}\NormalTok{(gdata)}
\CommentTok{# Read first sheet}
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.xls}\NormalTok{(}\StringTok{"datafile.xls"}\NormalTok{)}
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.xls}\NormalTok{(}\StringTok{"datafile.xls"}\NormalTok{, }\DataTypeTok{sheet=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Both the xlsx and gdata packages require other software to be installed on your computer. For xlsx, you need to install Java on your machine. For gdata, you need Perl, which comes as standard on Linux and Mac OS X, but not Windows. On Windows, you'll need ActiveState Perl. The Community Edition can be obtained for free.

\hypertarget{data-wrangling}{%
\chapter{Data Wrangling}\label{data-wrangling}}

\hypertarget{add-metadata-for-later-filtering}{%
\section{Add Metadata for later filtering}\label{add-metadata-for-later-filtering}}

Firstly we have to load a dataset into a dataframe:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# load data set}
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"https://github.com/hslu-ige-laes/edar/raw/master/sampleData/centralOutsideTemp.csv"}\NormalTok{,}
               \DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{,}
               \DataTypeTok{sep =}\StringTok{";"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{year-month-day-day-of-week}{%
\subsection{Year, Month, Day, Day of Week}\label{year-month-day-day-of-week}}

To group, filter and aggregate data we need to have a the date splitted up in day, month and year separately:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(dplyr)}
\KeywordTok{library}\NormalTok{(lubridate)}

\NormalTok{df}\OperatorTok{$}\NormalTok{time <-}\StringTok{ }\KeywordTok{parse_date_time}\NormalTok{(df}\OperatorTok{$}\NormalTok{time, }\StringTok{"YmdHMS"}\NormalTok{, }\DataTypeTok{tz =} \StringTok{"Europe/Zurich"}\NormalTok{)}
\NormalTok{df}\OperatorTok{$}\NormalTok{year <-}\StringTok{ }\KeywordTok{as.Date}\NormalTok{(}\KeywordTok{cut}\NormalTok{(df}\OperatorTok{$}\NormalTok{time, }\DataTypeTok{breaks =} \StringTok{"year"}\NormalTok{))}
\NormalTok{df}\OperatorTok{$}\NormalTok{month <-}\StringTok{ }\KeywordTok{as.Date}\NormalTok{(}\KeywordTok{cut}\NormalTok{(df}\OperatorTok{$}\NormalTok{time, }\DataTypeTok{breaks =} \StringTok{"month"}\NormalTok{))}
\NormalTok{df}\OperatorTok{$}\NormalTok{day <-}\StringTok{ }\KeywordTok{as.Date}\NormalTok{(}\KeywordTok{cut}\NormalTok{(df}\OperatorTok{$}\NormalTok{time, }\DataTypeTok{breaks =} \StringTok{"day"}\NormalTok{))}
\NormalTok{df}\OperatorTok{$}\NormalTok{weekday <-}\StringTok{ }\KeywordTok{weekdays}\NormalTok{(df}\OperatorTok{$}\NormalTok{time)}
\end{Highlighting}
\end{Shaded}

This code first parses the timestamp with a specific timezone. Then three columns are added.

Please note that the month also contains the year and a day. This is useful for a later step where you can group the series afterwards.

\newpage

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(df,}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                  time centralOutsideTemp       year      month        day
## 1 2018-03-21 11:00:00                5.2 2018-01-01 2018-03-01 2018-03-21
## 2 2018-03-21 12:00:00                6.7 2018-01-01 2018-03-01 2018-03-21
##    weekday
## 1 Mittwoch
## 2 Mittwoch
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tail}\NormalTok{(df,}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                      time centralOutsideTemp       year      month        day
## 21864 2020-09-17 10:00:00              26.65 2020-01-01 2020-09-01 2020-09-17
## 21865 2020-09-17 11:00:00              28.10 2020-01-01 2020-09-01 2020-09-17
##          weekday
## 21864 Donnerstag
## 21865 Donnerstag
\end{verbatim}

\hypertarget{season-of-year}{%
\subsection{Season of Year}\label{season-of-year}}

For some analyses it is useful to color single points of a scatterplot according to the season. For this we need to have the season in a separate column:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(redutils)}
\CommentTok{# get season from a date}
\KeywordTok{getSeason}\NormalTok{(}\KeywordTok{as.Date}\NormalTok{(}\StringTok{"2019-04-01"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Spring"
\end{verbatim}

If you want to change the language, you can give the function dedicated names for the season:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{getSeason}\NormalTok{(}\KeywordTok{as.Date}\NormalTok{(}\StringTok{"2019-04-01"}\NormalTok{),}
                  \DataTypeTok{seasonNames =} \KeywordTok{c}\NormalTok{(}\StringTok{"Winter"}\NormalTok{,}\StringTok{"Frühling","}\NormalTok{Sommer}\StringTok{","}\NormalTok{Herbst}\StringTok{"))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Frühling"
\end{verbatim}

To apply this function to a whole dataframe we can use the dplyr mutate function. The code below creates a new column named ``season'':

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df <-}\StringTok{ }\NormalTok{dplyr}\OperatorTok{::}\KeywordTok{mutate}\NormalTok{(df, }\DataTypeTok{season =} \KeywordTok{getSeason}\NormalTok{(df}\OperatorTok{$}\NormalTok{time))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(df,}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                  time centralOutsideTemp       year      month        day
## 1 2018-03-21 11:00:00                5.2 2018-01-01 2018-03-01 2018-03-21
##    weekday season
## 1 Mittwoch Spring
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tail}\NormalTok{(df,}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                      time centralOutsideTemp       year      month        day
## 21865 2020-09-17 11:00:00               28.1 2020-01-01 2020-09-01 2020-09-17
##          weekday season
## 21865 Donnerstag   Fall
\end{verbatim}

\hypertarget{data-frames}{%
\section{Data Frames}\label{data-frames}}

Firstly we have to load a dataset into a dataframe:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# load data set}
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"https://github.com/hslu-ige-laes/edar/raw/master/sampleData/flatTempHum.csv"}\NormalTok{,}
               \DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{,}
               \DataTypeTok{sep =}\StringTok{";"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{change-row-names}{%
\subsection{Change Row Names}\label{change-row-names}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Print the header and the first line}
\KeywordTok{head}\NormalTok{(df, }\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                  time FlatA_Hum FlatA_Temp FlatB_Hum FlatB_Temp FlatC_Hum
## 1 2018-10-03 00:00:00        53      24.43      38.8       22.4        44
##   FlatC_Temp FlatD_Hum FlatD_Temp
## 1       24.5        49      24.43
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# rename columns and print the header and the first line}
\KeywordTok{names}\NormalTok{(df) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"timestamp"}\NormalTok{,}\StringTok{"Hum_A"}\NormalTok{,}\StringTok{"Temp_A"}\NormalTok{,}\StringTok{"Hum_B"}\NormalTok{,}\StringTok{"Temp_B"}\NormalTok{,}\StringTok{"Hum_C"}\NormalTok{,}\StringTok{"Temp_C"}\NormalTok{,}\StringTok{"Hum_D"}\NormalTok{, }\StringTok{"Temp_D"}\NormalTok{)}
\KeywordTok{head}\NormalTok{(df, }\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             timestamp Hum_A Temp_A Hum_B Temp_B Hum_C Temp_C Hum_D Temp_D
## 1 2018-10-03 00:00:00    53  24.43  38.8   22.4    44   24.5    49  24.43
\end{verbatim}

\hypertarget{wide-to-long}{%
\subsection{Wide to Long}\label{wide-to-long}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create a copy of the dataframe and print the header and the first five line}
\KeywordTok{head}\NormalTok{(df, }\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             timestamp Hum_A Temp_A Hum_B Temp_B Hum_C Temp_C Hum_D Temp_D
## 1 2018-10-03 00:00:00  53.0  24.43  38.8  22.40  44.0   24.5  49.0  24.43
## 2 2018-10-03 01:00:00  53.0  24.40  38.8  22.40  44.0   24.5  49.0  24.40
## 3 2018-10-03 02:00:00  53.0  24.40  39.3  22.40  44.7   24.5  48.3  24.38
## 4 2018-10-03 03:00:00  53.0  24.40  40.3  22.40  45.0   24.5  48.0  24.33
## 5 2018-10-03 04:00:00  53.3  24.40  41.0  22.37  45.2   24.5  47.7  24.30
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# convert wide to long format}
\NormalTok{df.long <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(tidyr}\OperatorTok{::}\KeywordTok{pivot_longer}\NormalTok{(df,}
                                             \DataTypeTok{cols =} \OperatorTok{-}\NormalTok{timestamp,}
                                             \DataTypeTok{names_to =} \StringTok{"sensor"}\NormalTok{,}
                                             \DataTypeTok{values_to =} \StringTok{"value"}\NormalTok{,}
                                             \DataTypeTok{values_drop_na =} \OtherTok{TRUE}\NormalTok{)}
\NormalTok{                         )}

\CommentTok{# long format}
\KeywordTok{head}\NormalTok{(df.long, }\DecValTok{16}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##              timestamp sensor value
## 1  2018-10-03 00:00:00  Hum_A 53.00
## 2  2018-10-03 00:00:00 Temp_A 24.43
## 3  2018-10-03 00:00:00  Hum_B 38.80
## 4  2018-10-03 00:00:00 Temp_B 22.40
## 5  2018-10-03 00:00:00  Hum_C 44.00
## 6  2018-10-03 00:00:00 Temp_C 24.50
## 7  2018-10-03 00:00:00  Hum_D 49.00
## 8  2018-10-03 00:00:00 Temp_D 24.43
## 9  2018-10-03 01:00:00  Hum_A 53.00
## 10 2018-10-03 01:00:00 Temp_A 24.40
## 11 2018-10-03 01:00:00  Hum_B 38.80
## 12 2018-10-03 01:00:00 Temp_B 22.40
## 13 2018-10-03 01:00:00  Hum_C 44.00
## 14 2018-10-03 01:00:00 Temp_C 24.50
## 15 2018-10-03 01:00:00  Hum_D 49.00
## 16 2018-10-03 01:00:00 Temp_D 24.40
\end{verbatim}

\hypertarget{long-to-wide}{%
\subsection{Long to Wide}\label{long-to-wide}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# long format}
\KeywordTok{head}\NormalTok{(df.long)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             timestamp sensor value
## 1 2018-10-03 00:00:00  Hum_A 53.00
## 2 2018-10-03 00:00:00 Temp_A 24.43
## 3 2018-10-03 00:00:00  Hum_B 38.80
## 4 2018-10-03 00:00:00 Temp_B 22.40
## 5 2018-10-03 00:00:00  Hum_C 44.00
## 6 2018-10-03 00:00:00 Temp_C 24.50
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# convert long table into wide table}
\NormalTok{df.wide <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(tidyr}\OperatorTok{::}\KeywordTok{pivot_wider}\NormalTok{(df.long,}
                                            \DataTypeTok{names_from =} \StringTok{"sensor"}\NormalTok{,}
                                            \DataTypeTok{values_from =} \StringTok{"value"}\NormalTok{)}
\NormalTok{                         )}

\CommentTok{# wide format}
\KeywordTok{head}\NormalTok{(df.wide)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             timestamp Hum_A Temp_A Hum_B Temp_B Hum_C Temp_C Hum_D Temp_D
## 1 2018-10-03 00:00:00  53.0  24.43  38.8  22.40  44.0  24.50  49.0  24.43
## 2 2018-10-03 01:00:00  53.0  24.40  38.8  22.40  44.0  24.50  49.0  24.40
## 3 2018-10-03 02:00:00  53.0  24.40  39.3  22.40  44.7  24.50  48.3  24.38
## 4 2018-10-03 03:00:00  53.0  24.40  40.3  22.40  45.0  24.50  48.0  24.33
## 5 2018-10-03 04:00:00  53.3  24.40  41.0  22.37  45.2  24.50  47.7  24.30
## 6 2018-10-03 05:00:00  53.7  24.40  41.2  22.30  47.2  24.57  47.2  24.30
\end{verbatim}

\hypertarget{DATAWRANGLING-MERGE-TWO-DATAFRAMES}{%
\subsection{Merge two Dataframes}\label{DATAWRANGLING-MERGE-TWO-DATAFRAMES}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(dplyr)}
\KeywordTok{library}\NormalTok{(lubridate)}

\CommentTok{# read file one and parse dates}
\NormalTok{dfOutsideTemp <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"https://github.com/hslu-ige-laes/edar/raw/master/sampleData/centralOutsideTemp.csv"}\NormalTok{,}
                          \DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{,}
                          \DataTypeTok{sep =}\StringTok{";"}\NormalTok{)}

\NormalTok{dfOutsideTemp}\OperatorTok{$}\NormalTok{time <-}\StringTok{ }\KeywordTok{parse_date_time}\NormalTok{(dfOutsideTemp}\OperatorTok{$}\NormalTok{time,}
                                      \DataTypeTok{orders =} \StringTok{"YmdHMS"}\NormalTok{,}
                                      \DataTypeTok{tz =} \StringTok{"Europe/Zurich"}\NormalTok{)}

\CommentTok{# read file two and parse dates}
\NormalTok{dfFlatTempHum <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"https://github.com/hslu-ige-laes/edar/raw/master/sampleData/flatTempHum.csv"}\NormalTok{,}
                          \DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{, }\DataTypeTok{sep =}\StringTok{";"}\NormalTok{)}

\NormalTok{dfFlatTempHum}\OperatorTok{$}\NormalTok{time <-}\StringTok{ }\KeywordTok{parse_date_time}\NormalTok{(dfFlatTempHum}\OperatorTok{$}\NormalTok{time,}
                                      \DataTypeTok{order =} \StringTok{"YmdHMS"}\NormalTok{,}
                                      \DataTypeTok{tz =} \StringTok{"Europe/Zurich"}\NormalTok{)}

\CommentTok{# merge the two files into a new data frame and keep only rows where all values are available}
\NormalTok{df <-}\StringTok{ }\KeywordTok{merge}\NormalTok{(dfOutsideTemp, dfFlatTempHum, }\DataTypeTok{by =} \StringTok{"time"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{na.omit}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{examples}{%
\section{Examples}\label{examples}}

\hypertarget{import-csv-file-from-gwf-relay-w60-m-bus-logger}{%
\subsection{Import csv file from GWF Relay W60 M-Bus Logger}\label{import-csv-file-from-gwf-relay-w60-m-bus-logger}}

Some data loggers have a cryptic data format which requires some data wrangling ahead before we can use the time series efficiently. Following an example of a M-Bus data loggger.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tidyr)}

\CommentTok{# load csv file}
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"https://github.com/hslu-ige-laes/edar/raw/master/sampleData/flatHeatAndHotWater_GWF_RelayW60Logger.csv"}\NormalTok{,}
               \DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{,}
               \DataTypeTok{sep =}\StringTok{","}\NormalTok{)}
\KeywordTok{head}\NormalTok{(df,}\DecValTok{23}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       Datum  Zeit Adr ID.Nr. HST Nr.                  Wert Einheit
## 1  01.01.10 00:00   1      1 GWF   1                   729     kWh
## 2  01.01.10 00:00   1      1 GWF   2                 80.92     m^3
## 3  01.01.10 00:00   1      1 GWF   3                 80.75     m^3
## 4  01.01.10 00:00   1      1 GWF   4                    26      °C
## 5  01.01.10 00:00   1      1 GWF   5                    25      °C
## 6  01.01.10 00:00   1      1 GWF   6                   1.3       K
## 7  01.01.10 00:00   1      1 GWF   7                   375   hours
## 8  01.01.10 00:00   1      1 GWF   8                   375   hours
## 9  01.01.10 00:00   1      1 GWF   9                     0     l/h
## 10 01.01.10 00:00   1      1 GWF  10                     0      kW
## 11 01.01.10 00:00   1      1 GWF  11 31.12.09 23:58 Win  V        
## 12 01.01.10 00:00   1      1 GWF  12                    87     HCA
## 13 01.01.10 00:00   1      1 GWF  13                     0     HCA
## 14 01.01.10 00:00   1      1 GWF  14                     0     kWh
## 15 01.01.10 00:00   1      1 GWF  15                     0     m^3
## 16 01.01.10 00:00   1      1 GWF  16                     0     m^3
## 17 01.01.10 00:00   1      1 GWF  17                     0     HCA
## 18 01.01.10 00:00   1      1 GWF  18                     0     HCA
## 19 01.01.10 00:00   1      1 GWF  19              00.00.00        
## 20 01.01.10 00:00   1      1 GWF  20                   $00        
## 21 01.01.10 00:00   2      4 GWF   1                   751     kWh
## 22 01.01.10 00:00   2      4 GWF   2                 71.97     m^3
## 23 01.01.10 00:00   2      4 GWF   3                  71.9     m^3
##              Beschreibung      Art Modul SP.Nr. Tarif
## 1                  energy instant.     0      0     0
## 2                  volume instant.     0      0     0
## 3                  volume instant.     1      0     0
## 4        flow temperature instant.     0      0     0
## 5      return temperature instant.     0      0     0
## 6  temperature difference instant.     0      0     0
## 7                 on time instant.     0      0     0
## 8          operating time instant.     0      0     0
## 9             volume flow instant.     0      0     0
## 10                  power instant.     0      0     0
## 11             time point instant.     0      0     0
## 12               HCA-Unit instant.     1      0     0
## 13               HCA-Unit instant.     2      0     0
## 14                 energy instant.     0      1     0
## 15                 volume instant.     0      1     0
## 16                 volume instant.     1      1     0
## 17               HCA-Unit instant.     1      1     0
## 18               HCA-Unit instant.     2      1     0
## 19             time point instant.     0      1     0
## 20            M-Bus state             NA     NA    NA
## 21                 energy instant.     0      0     0
## 22                 volume instant.     0      0     0
## 23                 volume instant.     1      0     0
\end{verbatim}

Please note
* The Date and Time are in separate columns
* The HCA-Unit value has a factor of 10, so the above HCA-value of 87 are in 10 liters Units and result in 87 * 10 = 870 liter
* In the example ``Adr'' is the identification of the flat

We are only interested in Nr. 1 heating energy of the flat and Nr. 12 the impulse count of the additional meter which is the hot water of the flat.

Following the required steps to parse the data and bring them in a format we can later work with:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create timestamp out of column "Date" and "Time"}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{timestamp =} \KeywordTok{paste0}\NormalTok{(df}\OperatorTok{$}\NormalTok{Datum, }\StringTok{" "}\NormalTok{, df}\OperatorTok{$}\NormalTok{Zeit))}
\NormalTok{df}\OperatorTok{$}\NormalTok{timestamp <-}\StringTok{ }\KeywordTok{parse_date_time}\NormalTok{(df}\OperatorTok{$}\NormalTok{timestamp,}
                                \DataTypeTok{order =} \StringTok{"d.m.y H:M"}\NormalTok{,}
                                \DataTypeTok{tz =} \StringTok{"Europe/Zurich"}\NormalTok{)}


\CommentTok{# select columns and rearrange}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(timestamp, Adr, Nr., Wert, Einheit)}

\CommentTok{# filter out Adr. of interest}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(Nr. }\OperatorTok{%in%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{12}\NormalTok{))}

\CommentTok{# rename columns}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Nr. =} \KeywordTok{ifelse}\NormalTok{(Nr. }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{, }\KeywordTok{paste0}\NormalTok{(}\StringTok{"Adr"}\NormalTok{,}\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%02.0f"}\NormalTok{, Adr), }\StringTok{"_energyHeat"}\NormalTok{), }\KeywordTok{ifelse}\NormalTok{(Nr. }\OperatorTok{==}\StringTok{ }\DecValTok{12}\NormalTok{, }\KeywordTok{paste0}\NormalTok{(}\StringTok{"Adr"}\NormalTok{,}\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%02.0f"}\NormalTok{, Adr), }\StringTok{"_hotWater"}\NormalTok{), Nr.)))}

\CommentTok{# convert value to numeric}
\NormalTok{df}\OperatorTok{$}\NormalTok{Wert <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(df}\OperatorTok{$}\NormalTok{Wert)}

\CommentTok{# multiply HCA-values by factor 10 to get liters and divide by 1000 to get m3}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Wert =} \KeywordTok{ifelse}\NormalTok{((Einheit }\OperatorTok{==}\StringTok{ "HCA"}\NormalTok{), Wert }\OperatorTok{*}\StringTok{ }\DecValTok{10}\OperatorTok{/}\DecValTok{1000}\NormalTok{, Wert))}

\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\NormalTok{Einheit, }\OperatorTok{-}\NormalTok{Adr)}

\CommentTok{# convert long table into wide table}
\NormalTok{df.wide <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{pivot_wider}\NormalTok{(df,}
                                     \DataTypeTok{names_from =} \StringTok{"Nr."}\NormalTok{,}
                                     \DataTypeTok{values_from =}\NormalTok{ Wert,}
                                     \DataTypeTok{names_sep =} \StringTok{"_"}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

This is the result:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(df.wide)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    timestamp Adr01_energyHeat Adr01_hotWater Adr02_energyHeat Adr02_hotWater
## 1 2010-01-01              729           0.87              751           1.16
## 2 2010-02-01             1850           2.18             2276           7.55
## 3 2010-03-01             2806           5.84             2826          12.94
## 4 2010-04-01             3615           9.92             3354          18.51
## 5 2010-05-01             4150          13.38             3613          24.81
## 6 2010-06-01             4669          17.50             3640          29.72
##   Adr04_energyHeat Adr04_hotWater Adr03_energyHeat Adr03_hotWater
## 1              972           1.56              799           0.07
## 2             2526           8.14             3103           1.32
## 3             3690          14.83             4786           3.73
## 4             4700          20.82             6151           6.05
## 5             5341          27.06             6900           7.74
## 6             5802          31.61             7702           9.49
\end{verbatim}

Finally saving the csv file:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{write.csv2}\NormalTok{(df.wide,}
           \DataTypeTok{file =} \StringTok{"flatHeatAndHotWater.csv"}\NormalTok{,}
           \DataTypeTok{row.names =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{explorative-data-analysis}{%
\chapter{Explorative Data Analysis}\label{explorative-data-analysis}}

\hypertarget{get-overview}{%
\section{Get overview}\label{get-overview}}

\begin{quote}
Get an overview of the whole data set and specific series of it
\end{quote}

\hypertarget{load-data}{%
\subsection{Load data}\label{load-data}}

\begin{quote}
Load test data set in a data frame (e.g.~from a csv-file)
\end{quote}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"https://github.com/retomarek/r/raw/master/datasets/buildingMonitoringTestDataSet.csv"}\NormalTok{,}
               \DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{,}
               \DataTypeTok{sep =}\StringTok{","}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\hypertarget{names}{%
\subsection{Names}\label{names}}

\begin{quote}
show the column headers of the data frame
\end{quote}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{names}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "time"                 "WthStnPress"          "WthStnHum"           
##  [4] "WthStnRain"           "WthStnSolRad"         "WthStnTemp"          
##  [7] "WthStnWindDir"        "WthStnWindSpd"        "BldgEnergyHotwater"  
## [10] "BldgEnergyHeating"    "FlatHum"              "FlatTemp"            
## [13] "FlatVolFlowColdwater" "FlatVolFlowHotwater"
\end{verbatim}

\hypertarget{structure}{%
\subsection{Structure}\label{structure}}

\begin{quote}
show the structure of the data frame
\end{quote}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{str}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    16394 obs. of  14 variables:
##  $ time                : chr  "2018-09-30T22:00:00.000Z" "2018-09-30T23:00:00.000Z" "2018-10-01T00:00:00.000Z" "2018-10-01T01:00:00.000Z" ...
##  $ WthStnPress         : num  1012 1012 1011 1011 1011 ...
##  $ WthStnHum           : num  87 87.5 87.5 86.5 88 89 86.5 81 78 80.5 ...
##  $ WthStnRain          : num  0.8 1.1 0.5 0.5 0.6 0.1 0.2 0 0 0 ...
##  $ WthStnSolRad        : num  0 0 0 0 0 0 0 0 3 24.5 ...
##  $ WthStnTemp          : num  12.8 12.4 11.9 11.9 11.6 ...
##  $ WthStnWindDir       : num  157.5 11.2 146.2 157.5 146.2 ...
##  $ WthStnWindSpd       : num  3.2 1.6 2.4 0.8 2.4 0.8 0.8 3.2 4 3.2 ...
##  $ BldgEnergyHotwater  : num  0 19 0 0 0 ...
##  $ BldgEnergyHeating   : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ FlatHum             : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ FlatTemp            : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ FlatVolFlowColdwater: num  0.006 0 0 0 0.006 ...
##  $ FlatVolFlowHotwater : num  0 0 0 0 0 ...
\end{verbatim}

\hypertarget{headtail}{%
\subsection{Head/Tail}\label{headtail}}

The head and tail functions are generic, so they will work whether your data is stored in a simple data frane, a zoo object, or an xts object.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                       time WthStnPress WthStnHum WthStnRain WthStnSolRad
## 1 2018-09-30T22:00:00.000Z     1012.30      87.0        0.8            0
## 2 2018-09-30T23:00:00.000Z     1011.90      87.5        1.1            0
## 3 2018-10-01T00:00:00.000Z     1011.45      87.5        0.5            0
## 4 2018-10-01T01:00:00.000Z     1010.90      86.5        0.5            0
## 5 2018-10-01T02:00:00.000Z     1010.55      88.0        0.6            0
## 6 2018-10-01T03:00:00.000Z     1010.20      89.0        0.1            0
##   WthStnTemp WthStnWindDir WthStnWindSpd BldgEnergyHotwater BldgEnergyHeating
## 1      12.80        157.50           3.2                  0                 0
## 2      12.35         11.25           1.6                 19                 0
## 3      11.90        146.25           2.4                  0                 0
## 4      11.90        157.50           0.8                  0                 0
## 5      11.60        146.25           2.4                  0                 0
## 6      11.75         22.50           0.8                  0                 0
##   FlatHum FlatTemp FlatVolFlowColdwater FlatVolFlowHotwater
## 1      NA       NA                0.006                   0
## 2      NA       NA                0.000                   0
## 3      NA       NA                0.000                   0
## 4      NA       NA                0.000                   0
## 5      NA       NA                0.006                   0
## 6      NA       NA                0.000                   0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tail}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                           time WthStnPress WthStnHum WthStnRain WthStnSolRad
## 16389 2020-08-13T18:00:00.000Z    1011.650     74.75    2.19964            9
## 16390 2020-08-13T19:00:00.000Z    1012.000     79.00    2.19964            0
## 16391 2020-08-13T20:00:00.000Z    1011.950     78.25    2.19964            0
## 16392 2020-08-13T21:00:00.000Z    1012.025     76.50    2.19964            0
## 16393 2020-08-13T22:00:00.000Z    1012.250     73.00    0.00000            0
## 16394 2020-08-13T23:00:00.000Z          NA        NA         NA           NA
##       WthStnTemp WthStnWindDir WthStnWindSpd BldgEnergyHotwater
## 16389     22.000        162.00      0.000000                 NA
## 16390     20.175        124.25      1.609340                 NA
## 16391     19.350        125.00      0.402335                 NA
## 16392     19.900         93.00      1.609340                 NA
## 16393     20.625        116.25      2.414010                 NA
## 16394         NA            NA            NA                 NA
##       BldgEnergyHeating FlatHum FlatTemp FlatVolFlowColdwater
## 16389                NA      NA       NA                   NA
## 16390                NA      NA       NA                   NA
## 16391                NA      NA       NA                   NA
## 16392                NA      NA       NA                   NA
## 16393                NA      NA       NA                   NA
## 16394                NA      NA       NA                   NA
##       FlatVolFlowHotwater
## 16389                  NA
## 16390                  NA
## 16391                  NA
## 16392                  NA
## 16393                  NA
## 16394                  NA
\end{verbatim}

\hypertarget{five-number-summary}{%
\subsection{Five number summary}\label{five-number-summary}}

\begin{quote}
reveals details of a specific series
\end{quote}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(df}\OperatorTok{$}\NormalTok{WthStnTemp)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##   -5.25    5.50   11.25   11.99   17.35   40.30      12
\end{verbatim}

\hypertarget{basic-plots}{%
\section{Basic plots}\label{basic-plots}}

\hypertarget{scatterplot}{%
\subsection{Scatterplot}\label{scatterplot}}

\hypertarget{plot}{%
\subsubsection{plot()}\label{plot}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# load data set}
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"https://github.com/retomarek/r/raw/master/datasets/buildingMonitoringTestDataSet.csv"}\NormalTok{,}
               \DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{,}
               \DataTypeTok{sep =}\StringTok{","}\NormalTok{)}

\CommentTok{# crate simple scatterplot}
\KeywordTok{plot}\NormalTok{(df}\OperatorTok{$}\NormalTok{WthStnTemp, df}\OperatorTok{$}\NormalTok{BldgEnergyHeating)}
\end{Highlighting}
\end{Shaded}

\includegraphics{edar_files/figure-latex/scatterplot plot-1.pdf}

\hypertarget{data-visualizations}{%
\chapter{Data Visualizations}\label{data-visualizations}}

tbd

\hypertarget{room-temperature-reduction}{%
\section{Room Temperature Reduction}\label{room-temperature-reduction}}

\hypertarget{task}{%
\subsection{Task}\label{task}}

As part of an energy optimization, you lower the room temperatures in a room and would now like to show the reduction effect using the time series of the room temperature sensor. In the example below you make two optimizations at different dates.

You want to create a time series plot with

\begin{itemize}
\item
  the daily median, min and max value
\item
  the overall median of each period
\item
  the desired setpoint
\end{itemize}

\hypertarget{basis}{%
\subsection{Basis}\label{basis}}

\begin{itemize}
\tightlist
\item
  Time series data from e.g.~a temperature sensor with unaligned time intervals
\end{itemize}

\hypertarget{solution}{%
\subsection{Solution}\label{solution}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(dplyr)}
\KeywordTok{library}\NormalTok{(lubridate)}
\KeywordTok{library}\NormalTok{(dygraphs)}
\KeywordTok{library}\NormalTok{(xts)}
\KeywordTok{library}\NormalTok{(redutils)}
\KeywordTok{library}\NormalTok{(RColorBrewer)}

\CommentTok{# Settings}
\NormalTok{tempSetpoint =}\StringTok{ }\FloatTok{22.0}

\NormalTok{startDate =}\StringTok{ "2018-11-01"}
\NormalTok{endDate =}\StringTok{ "2019-02-01"}

\NormalTok{optiDate1 =}\StringTok{ "2018-12-17"}
\NormalTok{optiLabel1 =}\StringTok{ "Optimization I"}

\NormalTok{optiDate2 =}\StringTok{ "2019-01-03"}
\NormalTok{optiLabel2 =}\StringTok{ "Optimization II"}

\NormalTok{optiDelayDays =}\StringTok{ }\DecValTok{5}

\CommentTok{# read and print data}
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"https://github.com/hslu-ige-laes/edar/raw/master/sampleData/flatTempHum.csv"}\NormalTok{,}
                 \DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{,}
                 \DataTypeTok{sep =}\StringTok{";"}\NormalTok{)}

\CommentTok{# select temperature and remove empty cells}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(time, FlatA_Temp) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{na.omit}\NormalTok{()}

\CommentTok{# create column with day for later grouping}
\NormalTok{df}\OperatorTok{$}\NormalTok{time <-}\StringTok{ }\KeywordTok{parse_date_time}\NormalTok{(df}\OperatorTok{$}\NormalTok{time, }\StringTok{"YmdHMS"}\NormalTok{, }\DataTypeTok{tz =} \StringTok{"Europe/Zurich"}\NormalTok{)}
\NormalTok{df}\OperatorTok{$}\NormalTok{day <-}\StringTok{ }\KeywordTok{as.Date}\NormalTok{(}\KeywordTok{cut}\NormalTok{(df}\OperatorTok{$}\NormalTok{time, }\DataTypeTok{breaks =} \StringTok{"day"}\NormalTok{))}
\NormalTok{df}\OperatorTok{$}\NormalTok{day <-}\StringTok{ }\KeywordTok{as.Date}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(df}\OperatorTok{$}\NormalTok{day,}\StringTok{"%Y-%m-%d"}\NormalTok{))}

\CommentTok{# filter time range}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(day }\OperatorTok{>}\StringTok{ }\NormalTok{startDate, day }\OperatorTok{<}\StringTok{ }\NormalTok{endDate)}

\CommentTok{# calculate daily median, min and max of temperature}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(day) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{minDay =} \KeywordTok{min}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(FlatA_Temp)),}
         \DataTypeTok{medianDay =} \KeywordTok{median}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(FlatA_Temp)),}
         \DataTypeTok{maxDay =} \KeywordTok{max}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(FlatA_Temp))}
\NormalTok{         ) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ungroup}\NormalTok{()}

\CommentTok{# shrink down to daily values and remove rows with empty values}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(day, medianDay, minDay, maxDay) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{unique}\NormalTok{() }\OperatorTok{%>%}\StringTok{ }\KeywordTok{na.omit}\NormalTok{()}

\CommentTok{# calculate medians for time ranges}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{period =} \KeywordTok{ifelse}\NormalTok{(day }\OperatorTok{>=}\StringTok{ }\NormalTok{startDate }\OperatorTok{&}\StringTok{ }\NormalTok{day }\OperatorTok{<=}\StringTok{ }\NormalTok{optiDate1,}
                         \StringTok{"Baseline"}\NormalTok{,}
                         \KeywordTok{ifelse}\NormalTok{((day }\OperatorTok{>=}\StringTok{ }\NormalTok{(}\KeywordTok{as.Date}\NormalTok{(optiDate1) }\OperatorTok{+}\StringTok{ }\NormalTok{optiDelayDays))}
                                \OperatorTok{&}\StringTok{ }\NormalTok{(day }\OperatorTok{<=}\StringTok{ }\NormalTok{optiDate2),}
                                \StringTok{"Opti1"}\NormalTok{,}
                                \KeywordTok{ifelse}\NormalTok{((day }\OperatorTok{>=}\StringTok{ }\NormalTok{(}\KeywordTok{as.Date}\NormalTok{(optiDate2) }\OperatorTok{+}\StringTok{ }\NormalTok{optiDelayDays))}
                                \OperatorTok{&}\StringTok{ }\NormalTok{(day }\OperatorTok{<=}\StringTok{ }\NormalTok{endDate),}
                                \StringTok{"Opti2"}\NormalTok{,}
                                \OtherTok{NA}\NormalTok{)}
\NormalTok{                         )))}

\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(period) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{medianPeriod =} \KeywordTok{ifelse}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(period), }\OtherTok{NA}\NormalTok{, }\KeywordTok{median}\NormalTok{(medianDay))) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{ungroup}\NormalTok{() }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\NormalTok{period)}

\CommentTok{# create xts object for plotting}
\NormalTok{plotdata <-}\StringTok{ }\KeywordTok{xts}\NormalTok{( }\DataTypeTok{x=}\NormalTok{df[,}\OperatorTok{-}\DecValTok{1}\NormalTok{], }\DataTypeTok{order.by=}\NormalTok{df}\OperatorTok{$}\NormalTok{day)}

\CommentTok{# plot graph}
\KeywordTok{dygraph}\NormalTok{(plotdata, }\DataTypeTok{main =} \StringTok{"Room Temperature Reduction"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{dyAxis}\NormalTok{(}\StringTok{"x"}\NormalTok{, }\DataTypeTok{drawGrid =} \OtherTok{FALSE}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{dySeries}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"minDay"}\NormalTok{, }\StringTok{"medianDay"}\NormalTok{, }\StringTok{"maxDay"}\NormalTok{),}
           \DataTypeTok{label =} \StringTok{"Temperature"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{dySeries}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"medianPeriod"}\NormalTok{),}
           \DataTypeTok{label =} \StringTok{"Median Period"}\NormalTok{,}
           \DataTypeTok{strokePattern =} \StringTok{"dashed"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{dyOptions}\NormalTok{(}\DataTypeTok{colors =}\NormalTok{ RColorBrewer}\OperatorTok{::}\KeywordTok{brewer.pal}\NormalTok{(}\DecValTok{3}\NormalTok{, }\StringTok{"Set2"}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{dyEvent}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ optiDate1,}
          \DataTypeTok{label =}\NormalTok{ optiLabel1,}
          \DataTypeTok{labelLoc =} \StringTok{"bottom"}\NormalTok{,}
          \DataTypeTok{color =} \StringTok{"slategray"}\NormalTok{,}
          \DataTypeTok{strokePattern =} \StringTok{"dotted"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{dyEvent}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ optiDate2,}
          \DataTypeTok{label =}\NormalTok{ optiLabel2,}
          \DataTypeTok{labelLoc =} \StringTok{"bottom"}\NormalTok{,}
          \DataTypeTok{color =} \StringTok{"slategray"}\NormalTok{,}
          \DataTypeTok{strokePattern =} \StringTok{"dotted"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{dyLimit}\NormalTok{(tempSetpoint,}
          \DataTypeTok{color =} \StringTok{"red"}\NormalTok{,}
          \DataTypeTok{label =} \StringTok{"Target Setpoint"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{dyRangeSelector}\NormalTok{() }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{dyLegend}\NormalTok{(}\DataTypeTok{show =} \StringTok{"always"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{edar_files/figure-latex/tempreduction-1.pdf}

\hypertarget{discussion}{%
\subsection{Discussion}\label{discussion}}

In this example we used the dygraph package to create the graph. This package is fast and allows to show a rangeslider on the bottom of the graph. The exact same graph but without a slider is as well possible with ggplot.

Please note that the calculation of the periodic median after optimization I and II starts delayed because it takes time until the building has cooled down.

\hypertarget{energy-consumption-beforeafter-per-month}{%
\section{Energy Consumption Before/After per Month}\label{energy-consumption-beforeafter-per-month}}

\hypertarget{task-1}{%
\subsection{Task}\label{task-1}}

\begin{figure}
\includegraphics[width=0.7\linewidth]{images/plotEnergyConsBeforeAfter} \caption{Energy Consumption Before/After Optimization}\label{fig:unnamed-chunk-4}
\end{figure}

\hypertarget{basis-1}{%
\subsection{Basis}\label{basis-1}}

\hypertarget{solution-1}{%
\subsection{Solution}\label{solution-1}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(redutils)}
\KeywordTok{library}\NormalTok{(dplyr)}
\KeywordTok{library}\NormalTok{(plotly)}
\KeywordTok{library}\NormalTok{(htmlwidgets)}
\KeywordTok{library}\NormalTok{(ggthemes)}

\CommentTok{# load csv file}
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.csv2}\NormalTok{(}\StringTok{"https://github.com/hslu-ige-laes/edar/raw/master/sampleData/flatHeatAndHotWater.csv"}\NormalTok{,}
                \DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{)}

\CommentTok{# filter flat}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(timestamp, Adr02_energyHeat)}

\KeywordTok{colnames}\NormalTok{(df) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"timestamp"}\NormalTok{, }\StringTok{"meterValue"}\NormalTok{)}

\CommentTok{# calculate consumption value per month}
\CommentTok{# pay attention, the value of 2010-02-01 00:00:00 represents the meter reading on february first,}
\CommentTok{# so the consumption for february first is value(march) - value(february)!}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{value =} \KeywordTok{lead}\NormalTok{(meterValue) }\OperatorTok{-}\StringTok{ }\NormalTok{meterValue)}

\CommentTok{# remove counter value column}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\NormalTok{meterValue)}

\CommentTok{# create plot}
\NormalTok{plot <-}\StringTok{ }\KeywordTok{plotEnergyConsBeforeAfter}\NormalTok{(df,}
                                  \DataTypeTok{dateOptimization =} \StringTok{"2017-09-01"}\NormalTok{,}
                                  \DataTypeTok{locTimeZone =} \StringTok{"Europe/Zurich"}\NormalTok{,}
                                  \DataTypeTok{titlePlot =} \StringTok{"Before/After Optimization"}\NormalTok{,}
                                  \DataTypeTok{titleYAxis =} \StringTok{"Energy Consumption }\CharTok{\textbackslash{}n}\StringTok{(kWh/month)"}
\NormalTok{                                  )}

\CommentTok{# change theme (optional)}
\NormalTok{plot <-}\StringTok{ }\NormalTok{plot }\OperatorTok{+}\StringTok{ }\NormalTok{ggthemes}\OperatorTok{::}\KeywordTok{theme_economist}\NormalTok{()}

\CommentTok{# make plot interactive (optional)}
\NormalTok{plotly <-}\StringTok{ }\NormalTok{plotly}\OperatorTok{::}\KeywordTok{ggplotly}\NormalTok{(plot)}

\CommentTok{# show plot}
\NormalTok{plotly}
\end{Highlighting}
\end{Shaded}

\includegraphics{edar_files/figure-latex/energyConsBeforeAfter1-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# save static plot as png}
\KeywordTok{ggsave}\NormalTok{(}\StringTok{"images/plotEnergyConsBeforeAfter.png"}\NormalTok{, plot)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# save interactive plot as html}
\KeywordTok{library}\NormalTok{(htmlwidgets)}
\NormalTok{htmlwidgets}\OperatorTok{::}\KeywordTok{saveWidget}\NormalTok{(plotly, }\StringTok{"plotlyEnergyConsBeforeAfter.html"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{discussion-1}{%
\subsection{Discussion}\label{discussion-1}}

\hypertarget{building-energy-signature}{%
\section{Building Energy Signature}\label{building-energy-signature}}

\hypertarget{task-2}{%
\subsection{Task}\label{task-2}}

You want to create a scatter plot with

\begin{itemize}
\item
  the daily mean outside temperature on the x-axis
\item
  the daily energy consumption on the y-axis
\item
  points colored according to season
\end{itemize}

\hypertarget{basis-2}{%
\subsection{Basis}\label{basis-2}}

\begin{itemize}
\item
  Two separate csv files with time series data from the outside temperature and the energy data with unaligned time intervals
\item
  Energy consumption time series from a energy meter with steadily increasing meter values
\end{itemize}

\hypertarget{solution-2}{%
\subsection{Solution}\label{solution-2}}

After reading in the two time series the data has to get aggregated per day and then merged. Note that during the aggregation of the energy data you have to calculate the daily conspumption from the steadiliy increasing meter values as well.

Create a new script, copy/paste the following code and run it:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(ggplot2)}
\KeywordTok{library}\NormalTok{(plotly)}
\KeywordTok{library}\NormalTok{(dplyr)}
\KeywordTok{library}\NormalTok{(redutils)}
\KeywordTok{library}\NormalTok{(lubridate)}
\CommentTok{# load time series data and aggregate daily mean values}
\NormalTok{dfOutsideTemp <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"https://github.com/hslu-ige-laes/edar/raw/master/sampleData/centralOutsideTemp.csv"}\NormalTok{,}
                          \DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{,}
                          \DataTypeTok{sep =}\StringTok{";"}\NormalTok{)}
\NormalTok{dfOutsideTemp}\OperatorTok{$}\NormalTok{time <-}\StringTok{ }\KeywordTok{parse_date_time}\NormalTok{(dfOutsideTemp}\OperatorTok{$}\NormalTok{time,}
                                      \DataTypeTok{order =} \StringTok{"YmdHMS"}\NormalTok{,}
                                      \DataTypeTok{tz =} \StringTok{"Europe/Zurich"}\NormalTok{)}
\NormalTok{dfOutsideTemp}\OperatorTok{$}\NormalTok{day <-}\StringTok{ }\KeywordTok{as.Date}\NormalTok{(}\KeywordTok{cut}\NormalTok{(dfOutsideTemp}\OperatorTok{$}\NormalTok{time, }\DataTypeTok{breaks =} \StringTok{"day"}\NormalTok{))}
\NormalTok{dfOutsideTemp <-}\StringTok{ }\NormalTok{dfOutsideTemp }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(day) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{tempMean =} \KeywordTok{mean}\NormalTok{(centralOutsideTemp)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ungroup}\NormalTok{()}
\NormalTok{dfOutsideTemp <-}\StringTok{ }\NormalTok{dfOutsideTemp }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(day, tempMean) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{unique}\NormalTok{() }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{na.omit}\NormalTok{()}
\NormalTok{dfHeatEnergy <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"https://github.com/hslu-ige-laes/edar/raw/master/sampleData/centralHeating.csv"}\NormalTok{,}
                         \DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{,}
                         \DataTypeTok{sep =}\StringTok{";"}\NormalTok{)}
\NormalTok{dfHeatEnergy <-}\StringTok{ }\NormalTok{dfHeatEnergy }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(time, energyHeatingMeter) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{na.omit}\NormalTok{()}
\NormalTok{dfHeatEnergy}\OperatorTok{$}\NormalTok{time <-}\StringTok{ }\KeywordTok{parse_date_time}\NormalTok{(dfHeatEnergy}\OperatorTok{$}\NormalTok{time,}
                                     \DataTypeTok{orders =} \StringTok{"YmdHMS"}\NormalTok{,}
                                     \DataTypeTok{tz =} \StringTok{"Europe/Zurich"}\NormalTok{)}
\NormalTok{dfHeatEnergy}\OperatorTok{$}\NormalTok{day <-}\StringTok{ }\KeywordTok{as.Date}\NormalTok{(}\KeywordTok{cut}\NormalTok{(dfHeatEnergy}\OperatorTok{$}\NormalTok{time, }\DataTypeTok{breaks =} \StringTok{"day"}\NormalTok{))}
\NormalTok{dfHeatEnergy <-}\StringTok{ }\NormalTok{dfHeatEnergy }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(day) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{energyMax =} \KeywordTok{max}\NormalTok{(energyHeatingMeter)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ungroup}\NormalTok{()}
\NormalTok{dfHeatEnergy <-}\StringTok{ }\NormalTok{dfHeatEnergy }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(day, energyMax) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{unique}\NormalTok{() }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{na.omit}\NormalTok{()}
\NormalTok{dfHeatEnergy <-}\StringTok{ }\NormalTok{dfHeatEnergy }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{energyCons =}\NormalTok{ energyMax }\OperatorTok{-}\StringTok{ }\KeywordTok{lag}\NormalTok{(energyMax)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\NormalTok{energyMax) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{na.omit}\NormalTok{()}
\CommentTok{# merge the data in a tidy format}
\NormalTok{df <-}\StringTok{ }\KeywordTok{merge}\NormalTok{(dfOutsideTemp, dfHeatEnergy, }\DataTypeTok{by =} \StringTok{"day"}\NormalTok{)}
\CommentTok{# calculate season}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{season =}\NormalTok{ redutils}\OperatorTok{::}\KeywordTok{getSeason}\NormalTok{(df}\OperatorTok{$}\NormalTok{day))}
\CommentTok{# static chart with ggplot}
\NormalTok{p <-}\StringTok{ }\NormalTok{ggplot2}\OperatorTok{::}\KeywordTok{ggplot}\NormalTok{(df) }\OperatorTok{+}
\StringTok{  }\NormalTok{ggplot2}\OperatorTok{::}\KeywordTok{geom_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ tempMean,}
                          \DataTypeTok{y =}\NormalTok{ energyCons,}
                          \DataTypeTok{color =}\NormalTok{ season,}
                          \DataTypeTok{alpha =} \FloatTok{0.1}\NormalTok{,}
                          \DataTypeTok{text =} \KeywordTok{paste}\NormalTok{(}\StringTok{"</br>Date:  "}\NormalTok{, }\KeywordTok{as.Date}\NormalTok{(df}\OperatorTok{$}\NormalTok{day),}
                                       \StringTok{"</br>Temp: "}\NormalTok{, }\KeywordTok{round}\NormalTok{(df}\OperatorTok{$}\NormalTok{tempMean, }\DataTypeTok{digits =} \DecValTok{1}\NormalTok{), }\StringTok{"\textbackslash{}u00B0C"}\NormalTok{,}
                                       \StringTok{"</br>Energy: "}\NormalTok{, }\KeywordTok{round}\NormalTok{(df}\OperatorTok{$}\NormalTok{energyCons, }\DataTypeTok{digits =} \DecValTok{0}\NormalTok{), }\StringTok{"kWh/d"}\NormalTok{,}
                                       \StringTok{"</br>Season: "}\NormalTok{, df}\OperatorTok{$}\NormalTok{season))}
\NormalTok{                      ) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_color_manual}\NormalTok{(}\DataTypeTok{values=}\KeywordTok{c}\NormalTok{(}\StringTok{"#440154"}\NormalTok{, }\StringTok{"#2db27d"}\NormalTok{, }\StringTok{"#fde725"}\NormalTok{, }\StringTok{"#365c8d"}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{ggtitle}\NormalTok{(}\StringTok{"Building Energy Signature"}\NormalTok{) }\OperatorTok{+}
\StringTok{        }\KeywordTok{theme_minimal}\NormalTok{() }\OperatorTok{+}
\StringTok{        }\KeywordTok{theme}\NormalTok{(}
          \DataTypeTok{legend.position=}\StringTok{"none"}\NormalTok{,}
          \DataTypeTok{plot.title =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{hjust =} \FloatTok{0.5}\NormalTok{)}
\NormalTok{        )}
\CommentTok{# interactive chart}
\NormalTok{plotly}\OperatorTok{::}\KeywordTok{ggplotly}\NormalTok{(p, }\DataTypeTok{tooltip =} \KeywordTok{c}\NormalTok{(}\StringTok{"text"}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{layout}\NormalTok{(}\DataTypeTok{xaxis =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{title =} \StringTok{"Outside temperature (\textbackslash{}u00B0C)"}\NormalTok{,}
                      \DataTypeTok{range =} \KeywordTok{c}\NormalTok{(}\KeywordTok{min}\NormalTok{(}\OperatorTok{-}\DecValTok{5}\NormalTok{,}\KeywordTok{min}\NormalTok{(df}\OperatorTok{$}\NormalTok{tempMean)), }\KeywordTok{max}\NormalTok{(}\DecValTok{35}\NormalTok{,}\KeywordTok{max}\NormalTok{(df}\OperatorTok{$}\NormalTok{tempMean))), }\DataTypeTok{zeroline =}\NormalTok{ F),}
         \DataTypeTok{yaxis =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{title =} \StringTok{"Daily energy consumption (kWh/d)"}\NormalTok{,}
                      \DataTypeTok{range =} \KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{5}\NormalTok{, }\KeywordTok{max}\NormalTok{(df}\OperatorTok{$}\NormalTok{energyCons) }\OperatorTok{+}\StringTok{ }\DecValTok{10}\NormalTok{)),}
         \DataTypeTok{showlegend =} \OtherTok{TRUE}
\NormalTok{         ) }\OperatorTok{%>%}
\StringTok{  }\NormalTok{plotly}\OperatorTok{::}\KeywordTok{config}\NormalTok{(}\DataTypeTok{displayModeBar =} \OtherTok{FALSE}\NormalTok{, }\DataTypeTok{displaylogo =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{edar_files/figure-latex/energysignature ggplot-1.pdf}

\hypertarget{daily-energy-profiles}{%
\section{Daily Energy Profiles}\label{daily-energy-profiles}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# change language to English, otherwise weekdays are in local language}
\KeywordTok{Sys.setlocale}\NormalTok{(}\StringTok{"LC_TIME"}\NormalTok{, }\StringTok{"English"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "English_United States.1252"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(plotly)}
\KeywordTok{library}\NormalTok{(dplyr)}
\KeywordTok{library}\NormalTok{(lubridate)}

\CommentTok{# load time series data}
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"https://github.com/hslu-ige-laes/edar/raw/master/sampleData/eboBookEleMeter.csv"}\NormalTok{,}
               \DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{,}
               \DataTypeTok{sep =}\StringTok{";"}\NormalTok{)}

\CommentTok{# rename column names}
\KeywordTok{colnames}\NormalTok{(df) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"timestamp"}\NormalTok{, }\StringTok{"meterValue"}\NormalTok{)}

\NormalTok{df}\OperatorTok{$}\NormalTok{timestamp <-}\StringTok{ }\KeywordTok{parse_date_time}\NormalTok{(df}\OperatorTok{$}\NormalTok{timestamp,}
                                \DataTypeTok{orders =} \StringTok{"YmdHMS"}\NormalTok{,}
                                \DataTypeTok{tz =} \StringTok{"Europe/Zurich"}\NormalTok{)}
\NormalTok{df}\OperatorTok{$}\NormalTok{timestamp <-}\StringTok{ }\KeywordTok{force_tz}\NormalTok{(df}\OperatorTok{$}\NormalTok{timestamp, }\DataTypeTok{tzone =} \StringTok{"UTC"}\NormalTok{)}

\CommentTok{# uncomment to filter time range if necessary}
\CommentTok{#df <- df %>% filter(timestamp > "2015-03-01 00:00:00", timestamp < "2015-04-01 00:00:00")}

\CommentTok{# Fill missing values with NA}
\NormalTok{grid.df <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{timestamp =} \KeywordTok{seq}\NormalTok{(}\KeywordTok{min}\NormalTok{(df}\OperatorTok{$}\NormalTok{timestamp, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{),}
                                      \KeywordTok{max}\NormalTok{(df}\OperatorTok{$}\NormalTok{timestamp, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{),}
                                      \DataTypeTok{by =} \StringTok{"15 mins"}\NormalTok{))}
\NormalTok{df <-}\StringTok{ }\KeywordTok{merge}\NormalTok{(df, grid.df, }\DataTypeTok{all =} \OtherTok{TRUE}\NormalTok{)}

\CommentTok{# convert steadily counting energy meter value from kWh to power in kW}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{value =}\NormalTok{ (meterValue }\OperatorTok{-}\StringTok{ }\KeywordTok{lag}\NormalTok{(meterValue))}\OperatorTok{*}\DecValTok{4}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\NormalTok{meterValue) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{na.omit}\NormalTok{()}

\CommentTok{# remove negative values which occur beause of change summer/winter time}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(value }\OperatorTok{>=}\StringTok{ }\DecValTok{0}\NormalTok{)}

\CommentTok{# add metadata for later grouping and visualization purposes}
\NormalTok{df}\OperatorTok{$}\NormalTok{x <-}\StringTok{ }\KeywordTok{hour}\NormalTok{(df}\OperatorTok{$}\NormalTok{timestamp) }\OperatorTok{+}\StringTok{ }\KeywordTok{minute}\NormalTok{(df}\OperatorTok{$}\NormalTok{timestamp)}\OperatorTok{/}\DecValTok{60} \OperatorTok{+}\StringTok{ }\KeywordTok{second}\NormalTok{(df}\OperatorTok{$}\NormalTok{timestamp) }\OperatorTok{/}\StringTok{ }\DecValTok{3600}
\NormalTok{df}\OperatorTok{$}\NormalTok{weekday <-}\StringTok{ }\KeywordTok{weekdays}\NormalTok{(df}\OperatorTok{$}\NormalTok{timestamp)}
\NormalTok{df}\OperatorTok{$}\NormalTok{weekday <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(df}\OperatorTok{$}\NormalTok{weekday, }\KeywordTok{c}\NormalTok{(}\StringTok{"Monday"}\NormalTok{,}\StringTok{"Tuesday"}\NormalTok{,}\StringTok{"Wednesday"}\NormalTok{,}\StringTok{"Thursday"}\NormalTok{,}\StringTok{"Friday"}\NormalTok{,}\StringTok{"Saturday"}\NormalTok{, }\StringTok{"Sunday"}\NormalTok{))}
\NormalTok{df}\OperatorTok{$}\NormalTok{day <-}\StringTok{ }\KeywordTok{as.Date}\NormalTok{(df}\OperatorTok{$}\NormalTok{timestamp, }\DataTypeTok{format =} \StringTok{"%Y-%m-%d  %H:%M:%S"}\NormalTok{)}

\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{value =} \KeywordTok{ifelse}\NormalTok{(x }\OperatorTok{==}\StringTok{ }\FloatTok{0.00}\NormalTok{, }\OtherTok{NA}\NormalTok{, df}\OperatorTok{$}\NormalTok{value))}

\CommentTok{# plot graph with all time series}
\NormalTok{rangeX <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{24}\NormalTok{,}\FloatTok{0.25}\NormalTok{)}
\NormalTok{maxValue <-}\StringTok{ }\KeywordTok{max}\NormalTok{(df}\OperatorTok{$}\NormalTok{value, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{)}\OperatorTok{*}\FloatTok{1.05}

\NormalTok{df }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{highlight_key}\NormalTok{(}\OperatorTok{~}\NormalTok{day) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{plot_ly}\NormalTok{(}\DataTypeTok{x=}\OperatorTok{~}\NormalTok{x,}
          \DataTypeTok{y=}\OperatorTok{~}\NormalTok{value,}
          \DataTypeTok{color=}\OperatorTok{~}\NormalTok{weekday,}
          \DataTypeTok{type=}\StringTok{"scatter"}\NormalTok{,}
          \DataTypeTok{mode=}\StringTok{"lines"}\NormalTok{,}
          \DataTypeTok{line =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{width =} \DecValTok{1}\NormalTok{),}
          \DataTypeTok{alpha =} \FloatTok{0.15}\NormalTok{,}
          \DataTypeTok{colors =} \StringTok{"dodgerblue4"}\NormalTok{,}
          \DataTypeTok{text =} \OperatorTok{~}\NormalTok{day,}
          \DataTypeTok{hovertemplate =} \KeywordTok{paste}\NormalTok{(}\StringTok{"Time: "}\NormalTok{, }\KeywordTok{format}\NormalTok{(df}\OperatorTok{$}\NormalTok{timestamp, }\StringTok{"%H:%M"}\NormalTok{),}
                                \StringTok{"<br>Date: "}\NormalTok{, }\KeywordTok{format}\NormalTok{(df}\OperatorTok{$}\NormalTok{timestamp, }\StringTok{"%Y-%m-%d"}\NormalTok{),}
                                \StringTok{"<br>Value: %\{y:.0f\}"}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\CommentTok{# workaround with add_trace to have fixed y axis when selecting a dedicated day}
\StringTok{  }\KeywordTok{add_trace}\NormalTok{(}\DataTypeTok{x =} \DecValTok{0}\NormalTok{, }\DataTypeTok{y =} \DecValTok{0}\NormalTok{, }\DataTypeTok{type =} \StringTok{"scatter"}\NormalTok{, }\DataTypeTok{showlegend =} \OtherTok{FALSE}\NormalTok{, }\DataTypeTok{opacity=}\DecValTok{0}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{add_trace}\NormalTok{(}\DataTypeTok{x =} \DecValTok{24}\NormalTok{, }\DataTypeTok{y =}\NormalTok{ maxValue, }\DataTypeTok{type =} \StringTok{"scatter"}\NormalTok{, }\DataTypeTok{showlegend =} \OtherTok{FALSE}\NormalTok{, }\DataTypeTok{opacity=}\DecValTok{0}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{layout}\NormalTok{(}\DataTypeTok{title =} \StringTok{"Superimposed Profiles of Power Consumption per 15 min"}\NormalTok{,}
         \DataTypeTok{showlegend =} \OtherTok{TRUE}\NormalTok{,}
         \DataTypeTok{xaxis =} \KeywordTok{list}\NormalTok{(}
           \DataTypeTok{title =} \StringTok{"Hour of day"}\NormalTok{,}
           \DataTypeTok{range =}\NormalTok{ rangeX,}
           \DataTypeTok{tickvals =} \KeywordTok{list}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{6}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{12}\NormalTok{, }\DecValTok{15}\NormalTok{, }\DecValTok{18}\NormalTok{, }\DecValTok{21}\NormalTok{),}
           \DataTypeTok{showline=}\OtherTok{TRUE}
\NormalTok{           ),}
           \DataTypeTok{yaxis =} \KeywordTok{list}\NormalTok{(}
             \DataTypeTok{title =} \StringTok{"Power (kW)"}\NormalTok{,}
             \DataTypeTok{range =} \KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, maxValue)}
\NormalTok{           )}
\NormalTok{         ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{highlight}\NormalTok{(}\DataTypeTok{on =} \StringTok{"plotly_hover"}\NormalTok{,}
            \DataTypeTok{off =} \StringTok{"plotly_doubleclick"}\NormalTok{,}
            \DataTypeTok{color =} \StringTok{"orange"}\NormalTok{,}
            \DataTypeTok{opacityDim =} \FloatTok{1.0}\NormalTok{,}
            \DataTypeTok{selected =} \KeywordTok{attrs_selected}\NormalTok{(}\DataTypeTok{showlegend =} \OtherTok{FALSE}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\CommentTok{# this hides elements in the legend}
\StringTok{  }\NormalTok{plotly}\OperatorTok{::}\KeywordTok{config}\NormalTok{(}\DataTypeTok{modeBarButtons =} \KeywordTok{list}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\StringTok{"toImage"}\NormalTok{)), }\DataTypeTok{displaylogo =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{edar_files/figure-latex/energyprofiles1 plotly-1.pdf}

Next we want to create an overview with the mean values for each 15 minute slot per day.

Append the following code at the end of your script:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Calculate Mean value for all 15 minutes for each weekday}
\NormalTok{df2 <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(weekday, x) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{dayTimeMean =} \KeywordTok{mean}\NormalTok{(value)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ungroup}\NormalTok{()}

\CommentTok{# shrink data frame}
\NormalTok{df2 <-}\StringTok{ }\NormalTok{df2 }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(x, weekday, timestamp, dayTimeMean) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{unique}\NormalTok{() }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{na.omit}\NormalTok{() }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{arrange}\NormalTok{(weekday, x)}

\CommentTok{# plot graph with mean values}
\NormalTok{maxValMean <-}\StringTok{ }\KeywordTok{max}\NormalTok{(df2}\OperatorTok{$}\NormalTok{dayTimeMean, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{)}\OperatorTok{*}\FloatTok{1.05}

\NormalTok{df2 }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{highlight_key}\NormalTok{(}\OperatorTok{~}\NormalTok{weekday) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{plot_ly}\NormalTok{(}\DataTypeTok{x=}\OperatorTok{~}\NormalTok{x,}
          \DataTypeTok{y=}\OperatorTok{~}\NormalTok{dayTimeMean,}
          \DataTypeTok{color=}\OperatorTok{~}\NormalTok{weekday,}
          \DataTypeTok{type=}\StringTok{"scatter"}\NormalTok{,}
          \DataTypeTok{mode=}\StringTok{"lines"}\NormalTok{,}
          \DataTypeTok{alpha =} \FloatTok{0.25}\NormalTok{,}
          \DataTypeTok{colors =} \StringTok{"dodgerblue4"}\NormalTok{,}
          \DataTypeTok{text =} \OperatorTok{~}\NormalTok{weekday,}
          \DataTypeTok{hovertemplate =} \KeywordTok{paste}\NormalTok{(}\StringTok{"Time: "}\NormalTok{, }\KeywordTok{format}\NormalTok{(df2}\OperatorTok{$}\NormalTok{timestamp, }\StringTok{"%H:%M"}\NormalTok{),}
                                \StringTok{"<br>Mean: %\{y:.0f\}"}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\CommentTok{# workaround with add_trace to have fixed y axis when selecting a dedicated day}
\StringTok{  }\KeywordTok{add_trace}\NormalTok{(}\DataTypeTok{x =} \DecValTok{0}\NormalTok{, }\DataTypeTok{y =} \DecValTok{0}\NormalTok{, }\DataTypeTok{type =} \StringTok{"scatter"}\NormalTok{, }\DataTypeTok{showlegend =} \OtherTok{FALSE}\NormalTok{, }\DataTypeTok{opacity=}\DecValTok{0}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{add_trace}\NormalTok{(}\DataTypeTok{x =} \DecValTok{24}\NormalTok{, }\DataTypeTok{y =}\NormalTok{ maxValMean, }\DataTypeTok{type =} \StringTok{"scatter"}\NormalTok{, }\DataTypeTok{showlegend =} \OtherTok{FALSE}\NormalTok{, }\DataTypeTok{opacity=}\DecValTok{0}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{layout}\NormalTok{(}\DataTypeTok{title =} \StringTok{"Superimposed Mean Profiles of Power Consumption per 15 min"}\NormalTok{,}
         \DataTypeTok{showlegend =} \OtherTok{TRUE}\NormalTok{,}
         \DataTypeTok{xaxis =} \KeywordTok{list}\NormalTok{(}
           \DataTypeTok{title =} \StringTok{"Hour of day"}\NormalTok{,}
           \DataTypeTok{tickvals =} \KeywordTok{list}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{6}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{12}\NormalTok{, }\DecValTok{15}\NormalTok{, }\DecValTok{18}\NormalTok{, }\DecValTok{21}\NormalTok{)}
\NormalTok{         ),}
         \DataTypeTok{yaxis =} \KeywordTok{list}\NormalTok{(}
             \DataTypeTok{title =} \StringTok{"Power (kW)"}\NormalTok{,}
             \DataTypeTok{range =} \KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, maxValMean)}
\NormalTok{         )}
\NormalTok{  ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{highlight}\NormalTok{(}\DataTypeTok{on =} \StringTok{"plotly_hover"}\NormalTok{,}
            \DataTypeTok{off =} \StringTok{"plotly_doubleclick"}\NormalTok{,}
            \DataTypeTok{color =} \StringTok{"orange"}\NormalTok{,}
            \DataTypeTok{opacityDim =} \FloatTok{0.7}\NormalTok{,}
            \DataTypeTok{selected =} \KeywordTok{attrs_selected}\NormalTok{(}\DataTypeTok{showlegend =} \OtherTok{FALSE}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\CommentTok{# this hides elements in the legend}
\StringTok{  }\NormalTok{plotly}\OperatorTok{::}\KeywordTok{config}\NormalTok{(}\DataTypeTok{modeBarButtons =} \KeywordTok{list}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\StringTok{"toImage"}\NormalTok{)), }\DataTypeTok{displaylogo =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{edar_files/figure-latex/energyprofiles2 plotly-1.pdf}

\hypertarget{mollier-hx-diagram}{%
\section{Mollier hx Diagram}\label{mollier-hx-diagram}}

\hypertarget{task-3}{%
\subsection{Task}\label{task-3}}

You want to plot a mollier h-x diagram with

\begin{itemize}
\item
  scatter plot of temperature- and humidity sensor data (mean values per day)
\item
  points colored according to season
\item
  comfort zone
\end{itemize}

\hypertarget{basis-3}{%
\subsection{Basis}\label{basis-3}}

\begin{itemize}
\tightlist
\item
  A csv file with time series from multiple temperature and humidity sensors in °C and \%rH
\end{itemize}

\hypertarget{solution-3}{%
\subsection{Solution}\label{solution-3}}

The sensor data is not in a constant intervall and not yet aggregated. So after reading in the time series the data has to get filtered and aggregated per day.

Finally use the plot function \texttt{mollierHxDiagram} from the \texttt{redutils} package (R Energy Data Utilities).
If you have not yet installed this package, proceed as follows:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"devtools"}\NormalTok{)}
\KeywordTok{library}\NormalTok{(devtools)}
\KeywordTok{install_github}\NormalTok{(}\StringTok{"hslu-ige-laes/redutils"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Create a new script, copy/paste the following code and run it:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(redutils)}
\KeywordTok{library}\NormalTok{(dplyr)}
\KeywordTok{library}\NormalTok{(lubridate)}

\CommentTok{# read and print data}
\NormalTok{data <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"https://github.com/hslu-ige-laes/edar/raw/master/sampleData/flatTempHum.csv"}\NormalTok{,}
                 \DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{,}
                 \DataTypeTok{sep =}\StringTok{";"}\NormalTok{)}

\CommentTok{# select temperature and humidity and remove empty cells}
\NormalTok{data <-}\StringTok{ }\NormalTok{data }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(time, FlatA_Temp, FlatA_Hum) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{na.omit}\NormalTok{()}

\CommentTok{# create column with day for later grouping}
\NormalTok{data}\OperatorTok{$}\NormalTok{time <-}\StringTok{ }\KeywordTok{parse_date_time}\NormalTok{(data}\OperatorTok{$}\NormalTok{time, }\StringTok{"YmdHMS"}\NormalTok{, }\DataTypeTok{tz =} \StringTok{"Europe/Zurich"}\NormalTok{)}
\NormalTok{data}\OperatorTok{$}\NormalTok{day <-}\StringTok{ }\KeywordTok{as.Date}\NormalTok{(}\KeywordTok{cut}\NormalTok{(data}\OperatorTok{$}\NormalTok{time, }\DataTypeTok{breaks =} \StringTok{"day"}\NormalTok{))}

\CommentTok{# calculate daily mean of temperature and humidity}
\NormalTok{data <-}\StringTok{ }\NormalTok{data }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(day) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{tempMean =} \KeywordTok{mean}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(FlatA_Temp)),}
         \DataTypeTok{humMean =} \KeywordTok{mean}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(FlatA_Hum))}
\NormalTok{         ) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ungroup}\NormalTok{()}

\CommentTok{# shrink down to daily values and remove rows with empty values}
\NormalTok{data <-}\StringTok{ }\NormalTok{data }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(day, tempMean, humMean) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{unique}\NormalTok{() }\OperatorTok{%>%}\StringTok{ }\KeywordTok{na.omit}\NormalTok{()}

\CommentTok{# plot mollier hx diagram}
\KeywordTok{plotMollierHx}\NormalTok{(data)}
\end{Highlighting}
\end{Shaded}

\includegraphics{edar_files/figure-latex/mollier hx-1.pdf}

\hypertarget{sia-180-thermal-comfort}{%
\section{SIA 180 Thermal Comfort}\label{sia-180-thermal-comfort}}

\hypertarget{task-4}{%
\subsection{Task}\label{task-4}}

You want to plot a diagram like the one from the SIA 180:2014 which showes

\begin{itemize}
\item
  scatter plot of indoor- and outdoor temperature sensor data (indoor mean of day, outdoor mean of last 48 hours)
\item
  points colored according to season
\item
  different comfort lines
\end{itemize}

\hypertarget{basis-4}{%
\subsection{Basis}\label{basis-4}}

\begin{itemize}
\item
  A csv file with time series from multiple temperature and humidity sensors in °C
\item
  A csv file with the outdoor temperature
\end{itemize}

\hypertarget{solution-4}{%
\subsection{Solution}\label{solution-4}}

The sensor data is not in a constant intervall and not yet aggregated. So after reading in the time series the data has to get filtered, aggregated per day and merged.

Create a new script, copy/paste the following code and run it:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(redutils)}
\KeywordTok{library}\NormalTok{(dplyr)}
\KeywordTok{library}\NormalTok{(lubridate)}
\KeywordTok{library}\NormalTok{(zoo)}
\KeywordTok{library}\NormalTok{(plotly)}

\CommentTok{# load time series data and aggregate mean values}
\NormalTok{dfTempOa <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"https://github.com/hslu-ige-laes/edar/raw/master/sampleData/centralOutsideTemp.csv"}\NormalTok{,}
                          \DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{,}
                          \DataTypeTok{sep =}\StringTok{";"}\NormalTok{)}

\NormalTok{dfTempOa}\OperatorTok{$}\NormalTok{time <-}\StringTok{ }\KeywordTok{parse_date_time}\NormalTok{(dfTempOa}\OperatorTok{$}\NormalTok{time,}
                                      \DataTypeTok{order =} \StringTok{"YmdHMS"}\NormalTok{,}
                                      \DataTypeTok{tz =} \StringTok{"UTC"}\NormalTok{)}

\NormalTok{dfTempOa}\OperatorTok{$}\NormalTok{hour <-}\StringTok{ }\KeywordTok{cut}\NormalTok{(dfTempOa}\OperatorTok{$}\NormalTok{time, }\DataTypeTok{breaks =} \StringTok{"hour"}\NormalTok{)}

\NormalTok{dfTempOa <-}\StringTok{ }\NormalTok{dfTempOa }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(hour) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{tempMean =} \KeywordTok{mean}\NormalTok{(centralOutsideTemp)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ungroup}\NormalTok{() }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{select}\NormalTok{(time, tempMean) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{unique}\NormalTok{()}

\CommentTok{# Fill missing values with NA}
\NormalTok{grid.df <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{time =} \KeywordTok{seq}\NormalTok{(}\KeywordTok{min}\NormalTok{(dfTempOa}\OperatorTok{$}\NormalTok{time, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{),}
                                 \KeywordTok{max}\NormalTok{(dfTempOa}\OperatorTok{$}\NormalTok{time, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{),}
                                 \DataTypeTok{by =} \StringTok{"hour"}\NormalTok{))}
\NormalTok{dfTempOa <-}\StringTok{ }\KeywordTok{merge}\NormalTok{(dfTempOa, grid.df, }\DataTypeTok{all =} \OtherTok{TRUE}\NormalTok{)}

\NormalTok{dfTempOa <-}\StringTok{ }\NormalTok{dfTempOa }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{tempOa =} \KeywordTok{rollmean}\NormalTok{(tempMean, }\DecValTok{48}\NormalTok{, }\DataTypeTok{fill =} \OtherTok{NA}\NormalTok{, }\DataTypeTok{align =} \StringTok{"right"}\NormalTok{))}

\NormalTok{dfTempOa <-}\StringTok{ }\NormalTok{dfTempOa }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(time, tempOa) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{unique}\NormalTok{() }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{na.omit}\NormalTok{()}


\NormalTok{dfTempR <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"https://github.com/hslu-ige-laes/edar/raw/master/sampleData/flatTempHum.csv"}\NormalTok{,}
                       \DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{,}
                       \DataTypeTok{sep =}\StringTok{";"}\NormalTok{)}

\NormalTok{dfTempR}\OperatorTok{$}\NormalTok{time <-}\StringTok{ }\KeywordTok{parse_date_time}\NormalTok{(dfTempR}\OperatorTok{$}\NormalTok{time,}
                                   \DataTypeTok{order =} \StringTok{"YmdHMS"}\NormalTok{,}
                                   \DataTypeTok{tz =} \StringTok{"UTC"}\NormalTok{)}

\CommentTok{# select temperature and humidity and remove empty cells}
\NormalTok{dfTempR <-}\StringTok{ }\NormalTok{dfTempR }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(time, FlatA_Temp) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{na.omit}\NormalTok{()}

\NormalTok{dfTempR}\OperatorTok{$}\NormalTok{hour <-}\StringTok{ }\KeywordTok{cut}\NormalTok{(dfTempR}\OperatorTok{$}\NormalTok{time, }\DataTypeTok{breaks =} \StringTok{"hour"}\NormalTok{)}

\NormalTok{dfTempR <-}\StringTok{ }\NormalTok{dfTempR }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(hour) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{tempR =} \KeywordTok{mean}\NormalTok{(FlatA_Temp)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ungroup}\NormalTok{() }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{select}\NormalTok{(time, tempR) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{unique}\NormalTok{()}

\CommentTok{# Fill missing values with NA}
\NormalTok{grid.df <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{time =} \KeywordTok{seq}\NormalTok{(}\KeywordTok{min}\NormalTok{(dfTempR}\OperatorTok{$}\NormalTok{time, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{),}
                                 \KeywordTok{max}\NormalTok{(dfTempR}\OperatorTok{$}\NormalTok{time, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{),}
                                 \DataTypeTok{by =} \StringTok{"hour"}\NormalTok{))}
\NormalTok{dfTempR <-}\StringTok{ }\KeywordTok{merge}\NormalTok{(dfTempR, grid.df, }\DataTypeTok{all =} \OtherTok{TRUE}\NormalTok{)}

\NormalTok{data <-}\StringTok{ }\KeywordTok{merge}\NormalTok{(dfTempR, dfTempOa, }\DataTypeTok{all =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{unique}\NormalTok{() }\OperatorTok{%>%}\StringTok{ }\KeywordTok{na.omit}\NormalTok{()}

\NormalTok{data}\OperatorTok{$}\NormalTok{season <-}\StringTok{ }\NormalTok{redutils}\OperatorTok{::}\KeywordTok{getSeason}\NormalTok{(data}\OperatorTok{$}\NormalTok{time)}

\CommentTok{# plot diagram}

\CommentTok{# axis properties}
\NormalTok{minx <-}\StringTok{ }\KeywordTok{floor}\NormalTok{(}\KeywordTok{min}\NormalTok{(}\DecValTok{0}\NormalTok{, }\KeywordTok{min}\NormalTok{(data}\OperatorTok{$}\NormalTok{tempOa)))}
\NormalTok{maxx <-}\StringTok{ }\KeywordTok{ceiling}\NormalTok{(}\KeywordTok{max}\NormalTok{(}\DecValTok{28}\NormalTok{, }\KeywordTok{max}\NormalTok{(data}\OperatorTok{$}\NormalTok{tempOa)))}

\NormalTok{miny <-}\StringTok{ }\KeywordTok{floor}\NormalTok{(}\KeywordTok{min}\NormalTok{(}\FloatTok{21.0}\NormalTok{,}\KeywordTok{min}\NormalTok{(data}\OperatorTok{$}\NormalTok{tempR)))}\OperatorTok{-}\DecValTok{1}
\NormalTok{maxy <-}\StringTok{ }\KeywordTok{ceiling}\NormalTok{(}\KeywordTok{max}\NormalTok{(}\FloatTok{32.0}\NormalTok{,}\KeywordTok{max}\NormalTok{(data}\OperatorTok{$}\NormalTok{tempR)))}\OperatorTok{+}\DecValTok{1}

\CommentTok{# line setpoint heat}
\NormalTok{df.heatSp <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{tempOa =} \KeywordTok{c}\NormalTok{(minx, }\DecValTok{19}\NormalTok{, }\FloatTok{23.5}\NormalTok{, maxx), }\DataTypeTok{tempR =} \KeywordTok{c}\NormalTok{(}\FloatTok{20.5}\NormalTok{, }\FloatTok{20.5}\NormalTok{, }\DecValTok{22}\NormalTok{, }\DecValTok{22}\NormalTok{))}

\CommentTok{# line setpoint cool according to SIA 180:2014 Fig. 4}
\NormalTok{df.coolSp1 <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{tempOa =} \KeywordTok{c}\NormalTok{(minx, }\DecValTok{12}\NormalTok{, }\FloatTok{17.5}\NormalTok{, maxx),}\DataTypeTok{tempR =} \KeywordTok{c}\NormalTok{(}\FloatTok{24.5}\NormalTok{, }\FloatTok{24.5}\NormalTok{, }\FloatTok{26.5}\NormalTok{, }\FloatTok{26.5}\NormalTok{))}

\CommentTok{# line setpoint cool according to SIA 180:2014 Fig. 3}
\NormalTok{df.coolSp2 <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{tempOa =} \KeywordTok{c}\NormalTok{(minx, }\DecValTok{10}\NormalTok{, maxx),}\DataTypeTok{tempR =} \KeywordTok{c}\NormalTok{(}\DecValTok{25}\NormalTok{, }\DecValTok{25}\NormalTok{, }\FloatTok{0.33} \OperatorTok{*}\StringTok{ }\NormalTok{maxx }\OperatorTok{+}\StringTok{ }\FloatTok{21.8}\NormalTok{))}

\NormalTok{data }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{plot_ly}\NormalTok{(}\DataTypeTok{showlegend =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{add_lines}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ df.coolSp2,}
            \DataTypeTok{x =} \OperatorTok{~}\NormalTok{tempOa,}
            \DataTypeTok{y =} \OperatorTok{~}\NormalTok{tempR,}
            \DataTypeTok{name =} \StringTok{"Upper limit SIA 180 passive cooling"}\NormalTok{,}
            \DataTypeTok{opacity =} \FloatTok{0.7}\NormalTok{,}
            \DataTypeTok{color =} \StringTok{"#FDE725FF"}\NormalTok{,}
            \DataTypeTok{hoverinfo =} \StringTok{"text"}\NormalTok{,}
            \DataTypeTok{text =} \OperatorTok{~}\StringTok{ }\KeywordTok{paste}\NormalTok{(}\StringTok{"Upper limit SIA 180 passive cooling"}\NormalTok{,}
                           \StringTok{"<br />TempR:   "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f \textbackslash{}u00B0C"}\NormalTok{, tempR),}
                           \StringTok{"<br />TempOa: "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f \textbackslash{}u00B0C"}\NormalTok{, tempOa)}
\NormalTok{            )}
\NormalTok{  ) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{add_lines}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ df.coolSp1,}
            \DataTypeTok{x =} \OperatorTok{~}\NormalTok{tempOa,}
            \DataTypeTok{y =} \OperatorTok{~}\NormalTok{tempR,}
            \DataTypeTok{name =} \StringTok{"Upper limit SIA 180 active cooling"}\NormalTok{,}
            \DataTypeTok{opacity =} \FloatTok{0.7}\NormalTok{,}
            \DataTypeTok{color =} \StringTok{"#1E9B8AFF"}\NormalTok{,}
            \DataTypeTok{hoverinfo =} \StringTok{"text"}\NormalTok{,}
            \DataTypeTok{text =} \OperatorTok{~}\StringTok{ }\KeywordTok{paste}\NormalTok{(}\StringTok{"Upper limit SIA 180 active cooling"}\NormalTok{,}
                           \StringTok{"<br />TempR:   "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f \textbackslash{}u00B0C"}\NormalTok{, tempR),}
                           \StringTok{"<br />TempOa: "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f \textbackslash{}u00B0C"}\NormalTok{, tempOa)}
\NormalTok{            )        ) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{add_lines}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ df.heatSp,}
            \DataTypeTok{x =} \OperatorTok{~}\NormalTok{tempOa,}
            \DataTypeTok{y =} \OperatorTok{~}\NormalTok{tempR,}
            \DataTypeTok{name =} \StringTok{"Lower Limit SIA 180"}\NormalTok{,}
            \DataTypeTok{opacity =} \FloatTok{0.7}\NormalTok{,}
            \DataTypeTok{color =} \StringTok{"#440154FF"}\NormalTok{,}
            \DataTypeTok{hoverinfo =} \StringTok{"text"}\NormalTok{,}
            \DataTypeTok{text =} \OperatorTok{~}\StringTok{ }\KeywordTok{paste}\NormalTok{(}\StringTok{"Lower Limit SIA 180"}\NormalTok{,}
                           \StringTok{"<br />TempR:   "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f \textbackslash{}u00B0C"}\NormalTok{, tempR),}
                           \StringTok{"<br />TempOa: "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f \textbackslash{}u00B0C"}\NormalTok{, tempOa)}
\NormalTok{            )        ) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{add_markers}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ data }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(season }\OperatorTok{==}\StringTok{ "Spring"}\NormalTok{),}
              \DataTypeTok{x =} \OperatorTok{~}\NormalTok{tempOa,}
              \DataTypeTok{y =} \OperatorTok{~}\NormalTok{tempR,}
              \DataTypeTok{name =} \StringTok{"Spring"}\NormalTok{,}
              \DataTypeTok{marker =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{color =} \StringTok{"#2db27d"}\NormalTok{, }\DataTypeTok{opacity =} \FloatTok{0.1}\NormalTok{),}
              \DataTypeTok{hoverinfo =} \StringTok{"text"}\NormalTok{,}
              \DataTypeTok{text =} \OperatorTok{~}\StringTok{ }\KeywordTok{paste}\NormalTok{(}\StringTok{"TempR:   "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f \textbackslash{}u00B0C"}\NormalTok{, tempR),}
                             \StringTok{"<br />TempOa: "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f \textbackslash{}u00B0C"}\NormalTok{, tempOa),}
                             \StringTok{"<br />Date:       "}\NormalTok{, time,}
                             \StringTok{"<br />Season:  "}\NormalTok{, season}
\NormalTok{              )}
\NormalTok{  ) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{add_markers}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ data }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(season }\OperatorTok{==}\StringTok{ "Summer"}\NormalTok{),}
              \DataTypeTok{x =} \OperatorTok{~}\NormalTok{tempOa,}
              \DataTypeTok{y =} \OperatorTok{~}\NormalTok{tempR,}
              \DataTypeTok{name =} \StringTok{"Summer"}\NormalTok{,}
              \DataTypeTok{marker =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{color =} \StringTok{"#febc2b"}\NormalTok{, }\DataTypeTok{opacity =} \FloatTok{0.1}\NormalTok{),}
              \DataTypeTok{hoverinfo =} \StringTok{"text"}\NormalTok{,}
              \DataTypeTok{text =} \OperatorTok{~}\StringTok{ }\KeywordTok{paste}\NormalTok{(}\StringTok{"TempR:   "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f \textbackslash{}u00B0C"}\NormalTok{, tempR),}
                             \StringTok{"<br />TempOa: "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f \textbackslash{}u00B0C"}\NormalTok{, tempOa),}
                             \StringTok{"<br />Date:       "}\NormalTok{, time,}
                             \StringTok{"<br />Season:  "}\NormalTok{, season}
\NormalTok{              )}
\NormalTok{  ) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{add_markers}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ data }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(season }\OperatorTok{==}\StringTok{ "Fall"}\NormalTok{),}
              \DataTypeTok{x =} \OperatorTok{~}\NormalTok{tempOa,}
              \DataTypeTok{y =} \OperatorTok{~}\NormalTok{tempR,}
              \DataTypeTok{name =} \StringTok{"Fall"}\NormalTok{,}
              \DataTypeTok{marker =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{color =} \StringTok{"#440154"}\NormalTok{, }\DataTypeTok{opacity =} \FloatTok{0.1}\NormalTok{),}
              \DataTypeTok{hoverinfo =} \StringTok{"text"}\NormalTok{,}
              \DataTypeTok{text =} \OperatorTok{~}\StringTok{ }\KeywordTok{paste}\NormalTok{(}\StringTok{"TempR:   "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f \textbackslash{}u00B0C"}\NormalTok{, tempR),}
                             \StringTok{"<br />TempOa: "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f \textbackslash{}u00B0C"}\NormalTok{, tempOa),}
                             \StringTok{"<br />Date:       "}\NormalTok{, time,}
                             \StringTok{"<br />Season:  "}\NormalTok{, season}
\NormalTok{              )}
\NormalTok{  ) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{add_markers}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ data }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(season }\OperatorTok{==}\StringTok{ "Winter"}\NormalTok{),}
              \DataTypeTok{x =} \OperatorTok{~}\NormalTok{tempOa,}
              \DataTypeTok{y =} \OperatorTok{~}\NormalTok{tempR,}
              \DataTypeTok{name =} \StringTok{"Winter"}\NormalTok{,}
              \DataTypeTok{marker =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{color =} \StringTok{"#365c8d"}\NormalTok{, }\DataTypeTok{opacity =} \FloatTok{0.1}\NormalTok{),}
              \DataTypeTok{hoverinfo =} \StringTok{"text"}\NormalTok{,}
              \DataTypeTok{text =} \OperatorTok{~}\StringTok{ }\KeywordTok{paste}\NormalTok{(}\StringTok{"TempR:   "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f \textbackslash{}u00B0C"}\NormalTok{, tempR),}
                             \StringTok{"<br />TempOa: "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f \textbackslash{}u00B0C"}\NormalTok{, tempOa),}
                             \StringTok{"<br />Date:       "}\NormalTok{, time,}
                             \StringTok{"<br />Season:  "}\NormalTok{, season}
\NormalTok{              )}
\NormalTok{  ) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{layout}\NormalTok{(}
    \DataTypeTok{xaxis =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{title =} \StringTok{"Moving average outdoor temperature in \textbackslash{}u00B0C over 48 hours"}\NormalTok{,}
                 \DataTypeTok{range =} \KeywordTok{c}\NormalTok{(minx, maxx),}
                 \DataTypeTok{zeroline =} \OtherTok{FALSE}\NormalTok{,}
                 \DataTypeTok{tick0 =}\NormalTok{ minx,}
                 \DataTypeTok{dtick =} \DecValTok{2}\NormalTok{,}
                 \DataTypeTok{titlefont =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{size =} \DecValTok{14}\NormalTok{, }\DataTypeTok{color =} \StringTok{"darkgrey"}\NormalTok{)),}
    \DataTypeTok{yaxis =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{title =} \StringTok{"Room Temperature in \textbackslash{}u00B0C"}\NormalTok{,}
                 \DataTypeTok{range =} \KeywordTok{c}\NormalTok{(miny, maxy),}
                 \DataTypeTok{dtick =} \DecValTok{1}\NormalTok{,}
                 \DataTypeTok{titlefont =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{size =} \DecValTok{14}\NormalTok{, }\DataTypeTok{color =} \StringTok{"darkgrey"}\NormalTok{)),}
    \DataTypeTok{hoverlabel =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{align =} \StringTok{"left"}\NormalTok{),}
    \DataTypeTok{margin =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{l =} \DecValTok{80}\NormalTok{, }\DataTypeTok{t =} \DecValTok{50}\NormalTok{, }\DataTypeTok{r =} \DecValTok{50}\NormalTok{, }\DataTypeTok{b =} \DecValTok{10}\NormalTok{),}
    \DataTypeTok{legend =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{orientation =} \StringTok{'h'}\NormalTok{,}
                  \DataTypeTok{x =} \FloatTok{0.0}\NormalTok{,}
                  \DataTypeTok{y =} \FloatTok{-0.3}\NormalTok{)}
\NormalTok{  ) }\OperatorTok{%>%}
\StringTok{  }
\StringTok{  }\NormalTok{plotly}\OperatorTok{::}\KeywordTok{config}\NormalTok{(}\DataTypeTok{modeBarButtons =} \KeywordTok{list}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\StringTok{"toImage"}\NormalTok{)),}
                 \DataTypeTok{displaylogo =} \OtherTok{FALSE}\NormalTok{,}
                 \DataTypeTok{toImageButtonOptions =} \KeywordTok{list}\NormalTok{(}
                   \DataTypeTok{format =} \StringTok{"svg"}
\NormalTok{                 )}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\includegraphics{edar_files/figure-latex/sia180_1-1.pdf}

\hypertarget{discussion-2}{%
\subsection{Discussion}\label{discussion-2}}

tbd

\hypertarget{see-also}{%
\subsection{See Also}\label{see-also}}

tbd

\hypertarget{electricity-consumption-residential}{%
\section{Electricity Consumption Residential}\label{electricity-consumption-residential}}

\hypertarget{task-5}{%
\subsection{Task}\label{task-5}}

You want to plot an electricity consumption diagram which shows

\begin{itemize}
\tightlist
\item
  upper plot with daily energy consumption in kWh/day
\item
  lower plot with standby-losses in Watts
\end{itemize}

Additionaly we would like to see the consumption of an average Swiss household.

\hypertarget{basis-5}{%
\subsection{Basis}\label{basis-5}}

\begin{itemize}
\tightlist
\item
  A csv file with time series of an electric meter in 15 minute interval.
\end{itemize}

\hypertarget{solution-5}{%
\subsection{Solution}\label{solution-5}}

Create a new script, copy/paste the following code and run it:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(redutils)}
\KeywordTok{library}\NormalTok{(dplyr)}
\KeywordTok{library}\NormalTok{(lubridate)}
\KeywordTok{library}\NormalTok{(zoo)}
\KeywordTok{library}\NormalTok{(plotly)}

\CommentTok{# load time series data and aggregate mean values}
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"https://github.com/hslu-ige-laes/edar/raw/master/sampleData/flatElectricity.csv"}\NormalTok{,}
               \DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{,}
               \DataTypeTok{sep =}\StringTok{";"}\NormalTok{)}

\NormalTok{df}\OperatorTok{$}\NormalTok{time <-}\StringTok{ }\KeywordTok{parse_date_time}\NormalTok{(df}\OperatorTok{$}\NormalTok{time,}
                           \DataTypeTok{order =} \StringTok{"YmdHMS"}\NormalTok{,}
                           \DataTypeTok{tz =} \StringTok{"UTC"}\NormalTok{)}

\CommentTok{# select room}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(time, FlatC_Ele)}

\CommentTok{# rename columns}
\KeywordTok{colnames}\NormalTok{(df) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"timestamp"}\NormalTok{, }\StringTok{"meterValue"}\NormalTok{)}

\CommentTok{# filter timerange}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(timestamp }\OperatorTok{>}\StringTok{ "2019-07-01"}\NormalTok{)}

\CommentTok{# Fill missing values with NA}
\NormalTok{grid.df <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{timestamp =} \KeywordTok{seq}\NormalTok{(}\KeywordTok{min}\NormalTok{(df}\OperatorTok{$}\NormalTok{timestamp, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{),}
                                      \KeywordTok{max}\NormalTok{(df}\OperatorTok{$}\NormalTok{timestamp, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{),}
                                      \DataTypeTok{by =} \StringTok{"15 mins"}\NormalTok{))}
\NormalTok{df <-}\StringTok{ }\KeywordTok{merge}\NormalTok{(df, grid.df, }\DataTypeTok{all =} \OtherTok{TRUE}\NormalTok{)}

\CommentTok{# convert steadily counting energy meter value from kWh to power in kW}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{value =}\NormalTok{ (meterValue }\OperatorTok{-}\StringTok{ }\KeywordTok{lag}\NormalTok{(meterValue))) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\NormalTok{meterValue)}

\CommentTok{# remove negative values which occur beause of change summer/winter time}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(value }\OperatorTok{>=}\StringTok{ }\DecValTok{0}\NormalTok{)}

\CommentTok{# determine date related parameters for later filtering}
\NormalTok{df}\OperatorTok{$}\NormalTok{day <-}\StringTok{ }\KeywordTok{as.Date}\NormalTok{(df}\OperatorTok{$}\NormalTok{time, }\DataTypeTok{tz =} \StringTok{"UTC"}\NormalTok{)}
\NormalTok{df}\OperatorTok{$}\NormalTok{week <-}\StringTok{ }\NormalTok{lubridate}\OperatorTok{::}\KeywordTok{week}\NormalTok{(df}\OperatorTok{$}\NormalTok{time)}
\NormalTok{df}\OperatorTok{$}\NormalTok{month <-}\StringTok{ }\NormalTok{lubridate}\OperatorTok{::}\KeywordTok{month}\NormalTok{(df}\OperatorTok{$}\NormalTok{time)}
\NormalTok{df}\OperatorTok{$}\NormalTok{year <-}\StringTok{ }\NormalTok{lubridate}\OperatorTok{::}\KeywordTok{year}\NormalTok{(df}\OperatorTok{$}\NormalTok{time)}

\CommentTok{# data cleansing}
\CommentTok{# tag NA}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{deleteNA =} \KeywordTok{ifelse}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(value),}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{))}

\CommentTok{# tag values below 0 and higher than 9.2 kW}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{deleteHiLoVal =} \KeywordTok{ifelse}\NormalTok{(value }\OperatorTok{>}\StringTok{ }\FloatTok{9.2}\NormalTok{,}\DecValTok{1}\NormalTok{, }\KeywordTok{ifelse}\NormalTok{(value }\OperatorTok{<}\StringTok{ }\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{)))}
\CommentTok{# Assumption max. fuse 40 ampere (higher fuses for single family houses)}
\CommentTok{# this results in continuous power 9.2 kW}
\CommentTok{# this results in an hourly consumption of 9.2kWh}
\CommentTok{# over 24h = approx. 221 kWh max. consumption per day}

\CommentTok{# tag whole days which have one or more values to delete, keep only whole valid days}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(day) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{delete =} \KeywordTok{sum}\NormalTok{(deleteNA, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{sum}\NormalTok{(deleteHiLoVal, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{))}

\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ungroup}\NormalTok{()}

\CommentTok{# delete full days with invalid data}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(delete }\OperatorTok{==}\StringTok{ }\DecValTok{0}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\NormalTok{deleteNA, }\OperatorTok{-}\NormalTok{deleteHiLoVal, }\OperatorTok{-}\NormalTok{delete)}

\CommentTok{# determine season for later filtering}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{season =}\NormalTok{ redutils}\OperatorTok{::}\KeywordTok{getSeason}\NormalTok{(timestamp))}

\CommentTok{# calculate sum and min per day}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(day) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{sum =} \KeywordTok{sum}\NormalTok{(value))}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(day) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{min =} \KeywordTok{min}\NormalTok{(value)}\OperatorTok{*}\DecValTok{1000}\OperatorTok{*}\DecValTok{4}\NormalTok{)}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ungroup}\NormalTok{()}

\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(day, sum, min, season) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{unique}\NormalTok{()}

\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{ravgUsage =}\NormalTok{ zoo}\OperatorTok{::}\KeywordTok{rollmean}\NormalTok{(}\DataTypeTok{x=}\NormalTok{sum, }\DecValTok{7}\NormalTok{, }\DataTypeTok{fill =} \OtherTok{NA}\NormalTok{))}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{rminStandby =} \DecValTok{-1} \OperatorTok{*}\StringTok{ }\NormalTok{zoo}\OperatorTok{::}\KeywordTok{rollmaxr}\NormalTok{(}\DataTypeTok{x =} \DecValTok{-1} \OperatorTok{*}\StringTok{ }\NormalTok{min, }\DecValTok{7}\NormalTok{, }\DataTypeTok{fill =} \OtherTok{NA}\NormalTok{))}

\NormalTok{typEleConsVal <-}\StringTok{ }\NormalTok{redutils}\OperatorTok{::}\KeywordTok{getTypEleConsHousehold}\NormalTok{(}\DataTypeTok{occupants =} \DecValTok{2}\NormalTok{, }\DataTypeTok{rooms =} \FloatTok{3.5}\NormalTok{, }\DataTypeTok{bldgType =} \StringTok{"multi"}\NormalTok{, }\DataTypeTok{laundry =} \StringTok{"hotWaterSupply"}\NormalTok{)}\OperatorTok{/}\DecValTok{365}


\CommentTok{# Plot}

\NormalTok{minY <-}\StringTok{ }\DecValTok{0}
\NormalTok{maxYUsage <-}\StringTok{ }\KeywordTok{max}\NormalTok{(df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(sum), }\DataTypeTok{na.rm=}\OtherTok{TRUE}\NormalTok{)}
\NormalTok{maxYUsage <-}\StringTok{ }\KeywordTok{max}\NormalTok{(maxYUsage, typEleConsVal}\OperatorTok{/}\DecValTok{365}\NormalTok{)}
\NormalTok{maxYStandby <-}\StringTok{ }\KeywordTok{max}\NormalTok{(}\KeywordTok{max}\NormalTok{(df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(min), }\DataTypeTok{na.rm=}\OtherTok{TRUE}\NormalTok{), }\FloatTok{0.25}\OperatorTok{*}\NormalTok{maxYUsage}\OperatorTok{/}\DecValTok{24}\OperatorTok{*}\DecValTok{1000}\NormalTok{)}
\NormalTok{minX <-}\StringTok{ }\KeywordTok{min}\NormalTok{(df}\OperatorTok{$}\NormalTok{day)}
\NormalTok{maxX <-}\StringTok{ }\KeywordTok{max}\NormalTok{(df}\OperatorTok{$}\NormalTok{day)}
\NormalTok{averageUsage <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(df}\OperatorTok{$}\NormalTok{sum, }\DataTypeTok{na.rm=}\OtherTok{TRUE}\NormalTok{)}
\NormalTok{averageStandby <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(df}\OperatorTok{$}\NormalTok{rminStandby, }\DataTypeTok{na.rm=}\OtherTok{TRUE}\NormalTok{)}
\NormalTok{shareStandby <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(sum) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{na.omit}\NormalTok{()) }\OperatorTok{*}\StringTok{ }\NormalTok{averageStandby }\OperatorTok{*}\StringTok{ }\DecValTok{24} \OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{1000} \OperatorTok{*}\StringTok{ }\KeywordTok{sum}\NormalTok{(df}\OperatorTok{$}\NormalTok{sum, }\DataTypeTok{na.rm=}\OtherTok{TRUE}\NormalTok{)) }\OperatorTok{*}\StringTok{ }\DecValTok{100}

\CommentTok{# legend}
\NormalTok{l <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}
  \DataTypeTok{orientation =} \StringTok{"h"}\NormalTok{,}
  \DataTypeTok{tracegroupgap =} \StringTok{"20"}\NormalTok{,}
  \DataTypeTok{font =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{size =} \DecValTok{8}\NormalTok{),}
  \DataTypeTok{xanchor =} \StringTok{"center"}\NormalTok{,}
  \DataTypeTok{x =} \FloatTok{0.5}\NormalTok{,}
  \DataTypeTok{itemclick =} \OtherTok{FALSE}
\NormalTok{)}

\NormalTok{fig1 <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{plot_ly}\NormalTok{(}\DataTypeTok{x =} \OperatorTok{~}\NormalTok{day, }\DataTypeTok{showlegend =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{add_trace}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(season }\OperatorTok{==}\StringTok{ "Spring"}\NormalTok{),}
            \DataTypeTok{type =} \StringTok{"bar"}\NormalTok{,}
            \DataTypeTok{y =} \OperatorTok{~}\NormalTok{sum,}
            \DataTypeTok{name =} \StringTok{"Spring"}\NormalTok{,}
            \DataTypeTok{legendgroup =} \StringTok{"group1"}\NormalTok{,}
            \DataTypeTok{marker =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{color =} \StringTok{"#2db27d"}\NormalTok{, }\DataTypeTok{opacity =} \FloatTok{0.2}\NormalTok{),}
            \DataTypeTok{hoverinfo =} \StringTok{"text"}\NormalTok{,}
            \DataTypeTok{text =} \OperatorTok{~}\StringTok{ }\KeywordTok{paste}\NormalTok{(}\StringTok{"<br />daily usage:              "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f kWh/d"}\NormalTok{, sum),}
                           \StringTok{"<br />rolling average:        "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f kWh/d"}\NormalTok{, ravgUsage),}
                           \StringTok{"<br />Average vis. points: "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f kWh/d"}\NormalTok{, averageUsage),}
                           \StringTok{"<br />Date:                        "}\NormalTok{, day,}
                           \StringTok{"<br />Season:                   "}\NormalTok{, season}
\NormalTok{            )}
\NormalTok{  ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{add_trace}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(season }\OperatorTok{==}\StringTok{ "Summer"}\NormalTok{),}
            \DataTypeTok{type =} \StringTok{"bar"}\NormalTok{,}
            \DataTypeTok{y =} \OperatorTok{~}\NormalTok{sum,}
            \DataTypeTok{name =} \StringTok{"Summer"}\NormalTok{,}
            \DataTypeTok{legendgroup =} \StringTok{"group1"}\NormalTok{,}
            \DataTypeTok{marker =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{color =} \StringTok{"#febc2b"}\NormalTok{, }\DataTypeTok{opacity =} \FloatTok{0.2}\NormalTok{),}
            \DataTypeTok{hoverinfo =} \StringTok{"text"}\NormalTok{,}
            \DataTypeTok{text =} \OperatorTok{~}\StringTok{ }\KeywordTok{paste}\NormalTok{(}\StringTok{"<br />rolling average:        "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f kWh/d"}\NormalTok{, ravgUsage),}
                           \StringTok{"<br />Average vis. points: "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f kWh/d"}\NormalTok{, averageUsage),}
                           \StringTok{"<br />Date:                        "}\NormalTok{, day,}
                           \StringTok{"<br />Season:                   "}\NormalTok{, season}
\NormalTok{            )}
\NormalTok{  ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{add_trace}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(season }\OperatorTok{==}\StringTok{ "Fall"}\NormalTok{),}
            \DataTypeTok{type =} \StringTok{"bar"}\NormalTok{,}
            \DataTypeTok{y =} \OperatorTok{~}\NormalTok{sum,}
            \DataTypeTok{name =} \StringTok{"Fall"}\NormalTok{,}
            \DataTypeTok{legendgroup =} \StringTok{"group1"}\NormalTok{,}
            \DataTypeTok{marker =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{color =} \StringTok{"#440154"}\NormalTok{, }\DataTypeTok{opacity =} \FloatTok{0.2}\NormalTok{),}
            \DataTypeTok{hoverinfo =} \StringTok{"text"}\NormalTok{,}
            \DataTypeTok{text =} \OperatorTok{~}\StringTok{ }\KeywordTok{paste}\NormalTok{(}\StringTok{"<br />rolling average:        "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f kWh/d"}\NormalTok{, ravgUsage),}
                           \StringTok{"<br />Average vis. points: "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f kWh/d"}\NormalTok{, averageUsage),}
                           \StringTok{"<br />Date:                        "}\NormalTok{, day,}
                           \StringTok{"<br />Season:                   "}\NormalTok{, season}
\NormalTok{            )}
\NormalTok{  ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{add_trace}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(season }\OperatorTok{==}\StringTok{ "Winter"}\NormalTok{),}
            \DataTypeTok{type =} \StringTok{"bar"}\NormalTok{,}
            \DataTypeTok{y =} \OperatorTok{~}\NormalTok{sum,}
            \DataTypeTok{name =} \StringTok{"Winter"}\NormalTok{,}
            \DataTypeTok{legendgroup =} \StringTok{"group1"}\NormalTok{,}
            \DataTypeTok{marker =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{color =} \StringTok{"#365c8d"}\NormalTok{, }\DataTypeTok{opacity =} \FloatTok{0.2}\NormalTok{),}
            \DataTypeTok{hoverinfo =} \StringTok{"text"}\NormalTok{,}
            \DataTypeTok{text =} \OperatorTok{~}\StringTok{ }\KeywordTok{paste}\NormalTok{(}\StringTok{"<br />rolling average:        "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f kWh/d"}\NormalTok{, ravgUsage),}
                           \StringTok{"<br />Average vis. points: "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f kWh/d"}\NormalTok{, averageUsage),}
                           \StringTok{"<br />Date:                        "}\NormalTok{, day,}
                           \StringTok{"<br />Season:                   "}\NormalTok{, season}
\NormalTok{            )}
\NormalTok{  ) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{add_trace}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ df,}
            \DataTypeTok{type =} \StringTok{"scatter"}\NormalTok{,}
            \DataTypeTok{mode =} \StringTok{"markers"}\NormalTok{,}
            \DataTypeTok{y =} \OperatorTok{~}\NormalTok{ravgUsage,}
            \DataTypeTok{name =} \StringTok{"Average Cons. (7 days)"}\NormalTok{,}
            \DataTypeTok{legendgroup =} \StringTok{"group2"}\NormalTok{,}
            \DataTypeTok{marker =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{color =} \StringTok{"orange"}\NormalTok{, }\DataTypeTok{opacity =} \FloatTok{0.4}\NormalTok{, }\DataTypeTok{symbol =} \StringTok{"circle"}\NormalTok{),}
            \DataTypeTok{hoverinfo =} \StringTok{"text"}\NormalTok{,}
            \DataTypeTok{text =} \OperatorTok{~}\StringTok{ }\KeywordTok{paste}\NormalTok{(}\StringTok{"<br />rolling average:        "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f kWh/d"}\NormalTok{, ravgUsage),}
                           \StringTok{"<br />Average vis. points: "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f kWh/d"}\NormalTok{, averageUsage),}
                           \StringTok{"<br />Date:                        "}\NormalTok{, day,}
                           \StringTok{"<br />Season:                   "}\NormalTok{, season}
\NormalTok{            )}
\NormalTok{  ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{add_segments}\NormalTok{(}\DataTypeTok{x =} \OperatorTok{~}\NormalTok{minX,}
               \DataTypeTok{xend =} \OperatorTok{~}\NormalTok{maxX,}
               \DataTypeTok{y =} \OperatorTok{~}\NormalTok{averageUsage,}
               \DataTypeTok{yend =} \OperatorTok{~}\NormalTok{averageUsage,}
               \DataTypeTok{name =} \StringTok{"Average Cons. Total"}\NormalTok{,}
               \DataTypeTok{legendgroup =} \StringTok{"group2"}\NormalTok{,}
               \DataTypeTok{line =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{color =} \StringTok{"orange"}\NormalTok{, }\DataTypeTok{opacity =} \FloatTok{1.0}\NormalTok{, }\DataTypeTok{dash =} \StringTok{"dot"}\NormalTok{),}
               \DataTypeTok{hoverinfo =} \StringTok{"text"}\NormalTok{,}
               \DataTypeTok{text =} \OperatorTok{~}\StringTok{ }\KeywordTok{paste}\NormalTok{(}\StringTok{"<br />rolling average:        "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f kWh/d"}\NormalTok{, ravgUsage),}
                              \StringTok{"<br />Average vis. points: "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f kWh/d"}\NormalTok{, averageUsage),}
                              \StringTok{"<br />Date:                        "}\NormalTok{, day,}
                              \StringTok{"<br />Season:                   "}\NormalTok{, season}
\NormalTok{               )}
\NormalTok{  ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{add_segments}\NormalTok{(}\DataTypeTok{x =} \OperatorTok{~}\NormalTok{minX,}
               \DataTypeTok{xend =} \OperatorTok{~}\NormalTok{maxX,}
               \DataTypeTok{y =} \OperatorTok{~}\NormalTok{averageStandby}\OperatorTok{*}\DecValTok{24}\OperatorTok{/}\DecValTok{1000}\NormalTok{,}
               \DataTypeTok{yend =} \OperatorTok{~}\NormalTok{averageStandby}\OperatorTok{*}\DecValTok{24}\OperatorTok{/}\DecValTok{1000}\NormalTok{,}
               \DataTypeTok{name =} \StringTok{"Average Standby Total"}\NormalTok{,}
               \DataTypeTok{legendgroup =} \StringTok{"group3"}\NormalTok{,}
               \DataTypeTok{showlegend =} \OtherTok{FALSE}\NormalTok{,}
               \DataTypeTok{line =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{color =} \StringTok{"black"}\NormalTok{, }\DataTypeTok{opacity =} \FloatTok{1.0}\NormalTok{, }\DataTypeTok{dash =} \StringTok{"dot"}\NormalTok{),}
               \DataTypeTok{hoverinfo =} \StringTok{"text"}\NormalTok{,}
               \DataTypeTok{text =} \OperatorTok{~}\StringTok{ }\KeywordTok{paste}\NormalTok{(}\StringTok{"<br />Average standby power:          "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.0f W"}\NormalTok{, averageStandby),}
                              \StringTok{"<br />equals to daily energy:         "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f kWh"}\NormalTok{, averageStandby}\OperatorTok{*}\DecValTok{24}\OperatorTok{/}\DecValTok{1000}\NormalTok{),}
                              \StringTok{"<br />Standby percent of total cons.: "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.0f %%"}\NormalTok{, shareStandby)}
\NormalTok{               )}
\NormalTok{  ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{add_segments}\NormalTok{(}\DataTypeTok{x =} \OperatorTok{~}\NormalTok{minX,}
               \DataTypeTok{xend =} \OperatorTok{~}\NormalTok{maxX,}
               \DataTypeTok{y =} \OperatorTok{~}\NormalTok{typEleConsVal,}
               \DataTypeTok{yend =} \OperatorTok{~}\NormalTok{typEleConsVal,}
               \DataTypeTok{name =} \StringTok{"typical household"}\NormalTok{,}
               \DataTypeTok{legendgroup =} \StringTok{"group4"}\NormalTok{,}
               \DataTypeTok{line =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{color =} \StringTok{"#481567FF"}\NormalTok{, }\DataTypeTok{opacity =} \FloatTok{1.0}\NormalTok{, }\DataTypeTok{dash =} \StringTok{"dot"}\NormalTok{),}
               \DataTypeTok{hoverinfo =} \StringTok{"text"}\NormalTok{,}
               \DataTypeTok{text =} \OperatorTok{~}\StringTok{ }\KeywordTok{paste}\NormalTok{(}\StringTok{"<br />typical household:           "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.0f kWh/year"}\NormalTok{, typEleConsVal}\OperatorTok{*}\DecValTok{365}\NormalTok{),}
                              \StringTok{"<br />equals to daily energy:      "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f kWh/day"}\NormalTok{, typEleConsVal),}
                              \StringTok{"<br />consumption of current flat: "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f kWh/day"}\NormalTok{, averageUsage)}
\NormalTok{               )}
\NormalTok{  ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{add_annotations}\NormalTok{(}
    \DataTypeTok{x =}\NormalTok{ minX,}
    \DataTypeTok{y =}\NormalTok{ typEleConsVal,}
    \DataTypeTok{text =} \KeywordTok{paste0}\NormalTok{(}\StringTok{"typical comparable household "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f kWh/d"}\NormalTok{, typEleConsVal)),}
    \DataTypeTok{xref =} \StringTok{"x"}\NormalTok{,}
    \DataTypeTok{yref =} \StringTok{"y"}\NormalTok{,}
    \DataTypeTok{showarrow =} \OtherTok{TRUE}\NormalTok{,}
    \DataTypeTok{arrowhead =} \DecValTok{7}\NormalTok{,}
    \DataTypeTok{ax =} \DecValTok{100}\NormalTok{,}
    \DataTypeTok{ay =} \DecValTok{-20}\NormalTok{,}
    \DataTypeTok{font =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{color =} \StringTok{"#481567FF"}\NormalTok{)}
\NormalTok{  ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{add_annotations}\NormalTok{(}
    \DataTypeTok{x =}\NormalTok{ maxX,}
    \DataTypeTok{y =}\NormalTok{ averageUsage,}
    \DataTypeTok{text =} \KeywordTok{paste0}\NormalTok{(}\StringTok{"Average consumption "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f kWh/d"}\NormalTok{, averageUsage)),}
    \DataTypeTok{xref =} \StringTok{"x"}\NormalTok{,}
    \DataTypeTok{yref =} \StringTok{"y"}\NormalTok{,}
    \DataTypeTok{showarrow =} \OtherTok{TRUE}\NormalTok{,}
    \DataTypeTok{arrowhead =} \DecValTok{7}\NormalTok{,}
    \DataTypeTok{ax =} \DecValTok{-100}\NormalTok{,}
    \DataTypeTok{ay =} \DecValTok{-60}\NormalTok{,}
    \DataTypeTok{font =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{color =} \StringTok{"orange"}\NormalTok{)}
\NormalTok{  ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{add_annotations}\NormalTok{(}
    \DataTypeTok{x =}\NormalTok{ maxX,}
    \DataTypeTok{y =}\NormalTok{ averageStandby}\OperatorTok{*}\DecValTok{24}\OperatorTok{/}\DecValTok{1000}\NormalTok{,}
    \DataTypeTok{text =} \KeywordTok{paste0}\NormalTok{(}\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f %%"}\NormalTok{, shareStandby), }\StringTok{" of the consumption are standby-losses"}\NormalTok{),}
    \DataTypeTok{xref =} \StringTok{"x"}\NormalTok{,}
    \DataTypeTok{yref =} \StringTok{"y"}\NormalTok{,}
    \DataTypeTok{showarrow =} \OtherTok{TRUE}\NormalTok{,}
    \DataTypeTok{arrowhead =} \DecValTok{7}\NormalTok{,}
    \DataTypeTok{ax =} \DecValTok{-160}\NormalTok{,}
    \DataTypeTok{ay =} \DecValTok{-15}\NormalTok{,}
    \DataTypeTok{font =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{color =} \StringTok{"black"}\NormalTok{)}
\NormalTok{  ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{layout}\NormalTok{(}
    \DataTypeTok{xaxis =} \KeywordTok{list}\NormalTok{(}
      \DataTypeTok{title =} \StringTok{""}
\NormalTok{    ),}
    \DataTypeTok{yaxis =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{title =} \StringTok{"Consumption<br>(kWh/d)"}\NormalTok{,}
                 \DataTypeTok{range =} \KeywordTok{c}\NormalTok{(minY, maxYUsage),}
                 \DataTypeTok{titlefont =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{size =} \DecValTok{14}\NormalTok{, }\DataTypeTok{color =} \StringTok{"darkgrey"}\NormalTok{)),}
    \DataTypeTok{hoverlabel =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{align =} \StringTok{"left"}\NormalTok{),}
    \DataTypeTok{margin =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{l =} \DecValTok{80}\NormalTok{, }\DataTypeTok{t =} \DecValTok{50}\NormalTok{, }\DataTypeTok{r =} \DecValTok{50}\NormalTok{, }\DataTypeTok{b =} \DecValTok{10}\NormalTok{),}
    \DataTypeTok{legend =}\NormalTok{ l}
\NormalTok{  )}

\NormalTok{fig2 <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{plot_ly}\NormalTok{(}\DataTypeTok{x =} \OperatorTok{~}\NormalTok{day, }\DataTypeTok{showlegend =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{add_trace}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ df,}
            \DataTypeTok{type =} \StringTok{"bar"}\NormalTok{,}
            \DataTypeTok{y =} \OperatorTok{~}\NormalTok{min,}
            \DataTypeTok{name =} \StringTok{"Daily standby-losses"}\NormalTok{,}
            \DataTypeTok{legendgroup =} \StringTok{"group3"}\NormalTok{,}
            \DataTypeTok{marker =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{color =} \StringTok{"darkgrey"}\NormalTok{, }\DataTypeTok{opacity =} \FloatTok{0.2}\NormalTok{),}
            \DataTypeTok{hoverinfo =} \StringTok{"text"}\NormalTok{,}
            \DataTypeTok{text =} \OperatorTok{~}\StringTok{ }\KeywordTok{paste}\NormalTok{(}\StringTok{"<br />daily standby:           "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.0f W"}\NormalTok{, min),}
                           \StringTok{"<br />rolling average:        "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.0f W"}\NormalTok{, rminStandby),}
                           \StringTok{"<br />Average vis. points: "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.0f W"}\NormalTok{, averageStandby),}
                           \StringTok{"<br />Date:                        "}\NormalTok{, day,}
                           \StringTok{"<br />Season:                   "}\NormalTok{, season}
\NormalTok{            )}
\NormalTok{  ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{add_trace}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ df,}
            \DataTypeTok{type =} \StringTok{"scatter"}\NormalTok{,}
            \DataTypeTok{mode =} \StringTok{"markers"}\NormalTok{,}
            \DataTypeTok{y =} \OperatorTok{~}\NormalTok{rminStandby,}
            \DataTypeTok{name =} \StringTok{"Average Standby (7 days)"}\NormalTok{,}
            \DataTypeTok{legendgroup =} \StringTok{"group3"}\NormalTok{,}
            \DataTypeTok{marker =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{color =} \StringTok{"darkgrey"}\NormalTok{, }\DataTypeTok{opacity =} \FloatTok{0.5}\NormalTok{, }\DataTypeTok{symbol =} \StringTok{"circle"}\NormalTok{),}
            \DataTypeTok{hoverinfo =} \StringTok{"text"}\NormalTok{,}
            \DataTypeTok{text =} \OperatorTok{~}\StringTok{ }\KeywordTok{paste}\NormalTok{(}\StringTok{"<br />daily standby:           "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.0f W"}\NormalTok{, min),}
                           \StringTok{"<br />rolling average:        "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.0f W"}\NormalTok{, rminStandby),}
                           \StringTok{"<br />Average vis. points: "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.0f W"}\NormalTok{, averageStandby),}
                           \StringTok{"<br />Date:                        "}\NormalTok{, day,}
                           \StringTok{"<br />Season:                   "}\NormalTok{, season}
\NormalTok{            )}
\NormalTok{  ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{add_segments}\NormalTok{(}\DataTypeTok{x =} \OperatorTok{~}\NormalTok{minX,}
               \DataTypeTok{xend =} \OperatorTok{~}\NormalTok{maxX,}
               \DataTypeTok{y =} \OperatorTok{~}\NormalTok{averageStandby,}
               \DataTypeTok{yend =} \OperatorTok{~}\NormalTok{averageStandby,}
               \DataTypeTok{name =} \StringTok{"Average Standby Total"}\NormalTok{,}
               \DataTypeTok{legendgroup =} \StringTok{"group3"}\NormalTok{,}
               \DataTypeTok{line =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{color =} \StringTok{"black"}\NormalTok{, }\DataTypeTok{opacity =} \FloatTok{1.0}\NormalTok{, }\DataTypeTok{dash =} \StringTok{"dot"}\NormalTok{),}
               \DataTypeTok{hoverinfo =} \StringTok{"text"}\NormalTok{,}
               \DataTypeTok{text =} \OperatorTok{~}\StringTok{ }\KeywordTok{paste}\NormalTok{(}\StringTok{"<br />Average standby power:          "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.0f W"}\NormalTok{, averageStandby),}
                              \StringTok{"<br />equals to daily energy:         "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.1f kWh"}\NormalTok{, averageStandby}\OperatorTok{*}\DecValTok{24}\OperatorTok{/}\DecValTok{1000}\NormalTok{),}
                              \StringTok{"<br />Standby percent of total cons.: "}\NormalTok{, }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.0f %%"}\NormalTok{, shareStandby)}
\NormalTok{               )}
\NormalTok{  ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{add_annotations}\NormalTok{(}
    \DataTypeTok{x =}\NormalTok{ maxX,}
    \DataTypeTok{y =}\NormalTok{ averageStandby,}
    \DataTypeTok{text =} \KeywordTok{paste0}\NormalTok{(}\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%.0f W"}\NormalTok{, averageStandby), }\StringTok{" standby-losses on average"}\NormalTok{),}
    \DataTypeTok{xref =} \StringTok{"x"}\NormalTok{,}
    \DataTypeTok{yref =} \StringTok{"y"}\NormalTok{,}
    \DataTypeTok{showarrow =} \OtherTok{TRUE}\NormalTok{,}
    \DataTypeTok{arrowhead =} \DecValTok{7}\NormalTok{,}
    \DataTypeTok{ax =} \DecValTok{-60}\NormalTok{,}
    \DataTypeTok{ay =} \DecValTok{-20}\NormalTok{,}
    \DataTypeTok{font =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{color =} \StringTok{"black"}\NormalTok{)}
\NormalTok{  ) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{layout}\NormalTok{(}
    \DataTypeTok{xaxis =} \KeywordTok{list}\NormalTok{(}
      \DataTypeTok{title =} \StringTok{""}
\NormalTok{    ),}
    \DataTypeTok{yaxis =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{title =} \StringTok{" Standby<br>(W)"}\NormalTok{,}
                 \DataTypeTok{range =} \KeywordTok{c}\NormalTok{(minY, maxYStandby),}
                 \DataTypeTok{titlefont =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{size =} \DecValTok{14}\NormalTok{, }\DataTypeTok{color =} \StringTok{"darkgrey"}\NormalTok{),}
                 \DataTypeTok{legend =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{orientation =} \StringTok{'h'}\NormalTok{)),}
    \DataTypeTok{legend =}\NormalTok{ l}
\NormalTok{  )}

\CommentTok{# calculate ratio which is visual representative for comparison }
\CommentTok{# ratio <- 1/maxYUsage * maxYStandby * 24 / 1000}
\NormalTok{ratio <-}\StringTok{ }\FloatTok{0.3}
\NormalTok{fig <-}\StringTok{ }\KeywordTok{subplot}\NormalTok{(fig1, fig2, }\DataTypeTok{nrows =} \DecValTok{2}\NormalTok{, }\DataTypeTok{shareX =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{heights =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\OperatorTok{-}\NormalTok{ratio, ratio), }\DataTypeTok{titleY =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\NormalTok{plotly}\OperatorTok{::}\KeywordTok{config}\NormalTok{(}\DataTypeTok{modeBarButtons =} \KeywordTok{list}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\StringTok{"toImage"}\NormalTok{)),}
                 \DataTypeTok{displaylogo =} \OtherTok{FALSE}\NormalTok{,}
                 \DataTypeTok{toImageButtonOptions =} \KeywordTok{list}\NormalTok{(}
                   \DataTypeTok{format =} \StringTok{"svg"}
\NormalTok{                 )}
\NormalTok{  )}
\NormalTok{fig}
\end{Highlighting}
\end{Shaded}

\includegraphics{edar_files/figure-latex/eleplot-1.pdf}

\hypertarget{discussion-3}{%
\subsection{Discussion}\label{discussion-3}}

tbd

\hypertarget{see-also-1}{%
\subsection{See Also}\label{see-also-1}}

tbd

\hypertarget{appendix-appendix}{%
\appendix}


\hypertarget{packages}{%
\chapter{Packages in R}\label{packages}}

Many functions of R are not pre-installed and must be loaded manually. R packages are similar to libraries in C, Python etc. An R package bundles useful functions, help files and data sets. You can use these functions within your own R code once you load the package.

The following chapters describe how to install, load, update and use packages.

\hypertarget{installing-a-package}{%
\section{Installing a Package}\label{installing-a-package}}

The easiest way to install an R Package is to use the RStudio tab ``Packages'':

\begin{figure}
\includegraphics[width=0.5\linewidth]{images/a2-installPackagesRStudio} \caption{Install packages via RStudio GUI}\label{fig:knitr-logo}
\end{figure}

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\item
  Click on the ``Packages'' tab
\item
  Click on ``Install'' next to Update
\item
  Type the name of the package under ``Packages, in this case type ggplot2
\item
  Click ``Install''
\end{enumerate}

This will search for the package ``ggplot'' specified on a server (the so-called CRAN website). If the package exists, it will be downloaded to a library folder on your computer. Here R can access the package in future R sessions without having to reinstall it.

An other way is to use the install.packages function.
Open R (if already opened please close all projects) and type the following at the command line:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"ggplot2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

If you want to install a package directly from github, the package ``devtools'' must be installed first:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"devtools"}\NormalTok{)}
\KeywordTok{library}\NormalTok{(devtools)}
\KeywordTok{install_github}\NormalTok{(}\StringTok{"hslu-ige-laes/redutils"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{loading-a-package}{%
\section{Loading a Package}\label{loading-a-package}}

If you have installed a package, its functions are not yet available in your R project. To use an R package in your sript, you must load it with the following command:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"ggplot2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{upgrading-packages}{%
\section{Upgrading Packages}\label{upgrading-packages}}

R packages are often constantly updated on CRAN or GitHub, so you may want to update them once in a while with:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{update.packages}\NormalTok{(}\DataTypeTok{ask =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

  \bibliography{book.bib,packages.bib}

\end{document}
