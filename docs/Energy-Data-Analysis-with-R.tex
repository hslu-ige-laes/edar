% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{book}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Energy Data Analysis with R},
  pdfauthor={Lucerne University of Sciences and Arts, Engineering \& Architecture, Institute of Building Technology and Energy IGE, Reto Marek},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs}
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{booktabs}
\usepackage{amsthm}
\makeatletter
\def\thm@space@setup{%
  \thm@preskip=8pt plus 2pt minus 4pt
  \thm@postskip=\thm@preskip
}
\makeatother
\usepackage[]{natbib}
\bibliographystyle{apalike}

\title{Energy Data Analysis with R}
\author{Lucerne University of Sciences and Arts, Engineering \& Architecture, Institute of Building Technology and Energy IGE, Reto Marek}
\date{2020-10-30}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{preface}{%
\chapter*{Preface}\label{preface}}
\addcontentsline{toc}{chapter}{Preface}

This document gives you a short overview of the statistical software R and its ability to analyze and visualize time series in the context of building energy and comfort.

This book is aimed at R beginners as well as advanced R users and is strongly inspired by the {[}R Graphics Cookbook{]} (\url{https://r-graphics.org/}). The goal of this book is to additionaly provide specific recipes for energy and comfort related tasks.

The recipes in this book will show you how to complete certain specific tasks. Examples are shown so that you can understand the basic principle and reproduce the analysis or visualization with your own data.

\hypertarget{why-r-and-rstudio}{%
\section{Why R and RStudio?}\label{why-r-and-rstudio}}

Spreadsheet programs like Excel quickly reach their limits when working with large data sets or creating complex graphics. Also the interactive ability of the graphics is limited. The open source programming language R and its graphical user interface RStudio offer many more possibilities for data analysis and data visualization.

\textbf{Disclaimer}
The authors decline any liability or responsibility in connection with the published documentation

© Lucerne University of Sciences and Arts, 2020

\hypertarget{getting-started}{%
\chapter{Getting started}\label{getting-started}}

First you have to install R and RStudio.

\hypertarget{r-basics}{%
\chapter{R Basics}\label{r-basics}}

\hypertarget{importing-data}{%
\section{Importing data}\label{importing-data}}

\hypertarget{csv-file}{%
\subsection{csv file}\label{csv-file}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"datafile.csv"}\NormalTok{)}
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"datafile.csv"}\NormalTok{, }\DataTypeTok{header=}\OtherTok{FALSE}\NormalTok{, }\DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"https://github.com/retomarek/r/raw/master/datasets/buildingMonitoringTestDataSet.csv"}\NormalTok{, }\DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{, }\DataTypeTok{sep =}\StringTok{","}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

Attention: By default, strings in the data are treated as factors.
read.csv() is a convenience wrapper function around read.table(). If you need more control over the input, see ?read.table

\hypertarget{excel-file}{%
\subsection{Excel File}\label{excel-file}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Only need to install once}
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"xlsx"}\NormalTok{)}

\KeywordTok{library}\NormalTok{(xslx)}

\NormalTok{df <-}\StringTok{ }\KeywordTok{read.xlsx}\NormalTok{(}\StringTok{"datafile.xlsx"}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.xlsx}\NormalTok{(}\StringTok{"datafile.xls"}\NormalTok{, }\DataTypeTok{sheetIndex=}\DecValTok{2}\NormalTok{)}
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.xlsx}\NormalTok{(}\StringTok{"datafile.xls"}\NormalTok{, }\DataTypeTok{sheetName=}\StringTok{"Revenues"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

For reading older Excel files in the .xls format, the gdata package has the function read.xls():

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Only need to install once}
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"gdata"}\NormalTok{)}

\KeywordTok{library}\NormalTok{(gdata)}
\CommentTok{# Read first sheet}
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.xls}\NormalTok{(}\StringTok{"datafile.xls"}\NormalTok{)}
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.xls}\NormalTok{(}\StringTok{"datafile.xls"}\NormalTok{, }\DataTypeTok{sheet=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Both the xlsx and gdata packages require other software to be installed on your computer. For xlsx, you need to install Java on your machine. For gdata, you need Perl, which comes as standard on Linux and Mac OS X, but not Windows. On Windows, you'll need ActiveState Perl. The Community Edition can be obtained for free.

\hypertarget{data-manipulations}{%
\section{Data manipulations}\label{data-manipulations}}

\hypertarget{data-frames}{%
\subsection{data frames}\label{data-frames}}

\hypertarget{change-row-names-of-df}{%
\subsubsection{change row names of df}\label{change-row-names-of-df}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{names}\NormalTok{(df) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Column1"}\NormalTok{,}\StringTok{"Column2"}\NormalTok{,}\StringTok{"Column3"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{wide-to-long}{%
\subsection{wide to long}\label{wide-to-long}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# wide format}
\KeywordTok{head}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                       time WthStnPress WthStnHum WthStnRain WthStnSolRad
## 1 2018-09-30T22:00:00.000Z     1012.30      87.0        0.8            0
## 2 2018-09-30T23:00:00.000Z     1011.90      87.5        1.1            0
## 3 2018-10-01T00:00:00.000Z     1011.45      87.5        0.5            0
## 4 2018-10-01T01:00:00.000Z     1010.90      86.5        0.5            0
## 5 2018-10-01T02:00:00.000Z     1010.55      88.0        0.6            0
## 6 2018-10-01T03:00:00.000Z     1010.20      89.0        0.1            0
##   WthStnTemp WthStnWindDir WthStnWindSpd BldgEnergyHotwater BldgEnergyHeating
## 1      12.80        157.50           3.2                  0                 0
## 2      12.35         11.25           1.6                 19                 0
## 3      11.90        146.25           2.4                  0                 0
## 4      11.90        157.50           0.8                  0                 0
## 5      11.60        146.25           2.4                  0                 0
## 6      11.75         22.50           0.8                  0                 0
##   FlatHum FlatTemp FlatVolFlowColdwater FlatVolFlowHotwater
## 1      NA       NA                0.006                   0
## 2      NA       NA                0.000                   0
## 3      NA       NA                0.000                   0
## 4      NA       NA                0.000                   0
## 5      NA       NA                0.006                   0
## 6      NA       NA                0.000                   0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# convert wide to long format}
\NormalTok{df.long <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(tidyr}\OperatorTok{::}\KeywordTok{pivot_longer}\NormalTok{(df,}
                                      \DataTypeTok{cols =} \OperatorTok{-}\NormalTok{time,}
                                      \DataTypeTok{names_to =} \StringTok{"name"}\NormalTok{,}
                                      \DataTypeTok{values_to =} \StringTok{"value"}\NormalTok{,}
                                      \DataTypeTok{values_drop_na =} \OtherTok{TRUE}\NormalTok{)}
\NormalTok{                         )}

\CommentTok{# long format}
\KeywordTok{head}\NormalTok{(df.long)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                       time          name  value
## 1 2018-09-30T22:00:00.000Z   WthStnPress 1012.3
## 2 2018-09-30T22:00:00.000Z     WthStnHum   87.0
## 3 2018-09-30T22:00:00.000Z    WthStnRain    0.8
## 4 2018-09-30T22:00:00.000Z  WthStnSolRad    0.0
## 5 2018-09-30T22:00:00.000Z    WthStnTemp   12.8
## 6 2018-09-30T22:00:00.000Z WthStnWindDir  157.5
\end{verbatim}

\hypertarget{long-to-wide}{%
\subsection{long to wide}\label{long-to-wide}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# long format}
\KeywordTok{head}\NormalTok{(df.long)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                       time          name  value
## 1 2018-09-30T22:00:00.000Z   WthStnPress 1012.3
## 2 2018-09-30T22:00:00.000Z     WthStnHum   87.0
## 3 2018-09-30T22:00:00.000Z    WthStnRain    0.8
## 4 2018-09-30T22:00:00.000Z  WthStnSolRad    0.0
## 5 2018-09-30T22:00:00.000Z    WthStnTemp   12.8
## 6 2018-09-30T22:00:00.000Z WthStnWindDir  157.5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# convert long table into wide table}
\NormalTok{df.wide <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(tidyr}\OperatorTok{::}\KeywordTok{pivot_wider}\NormalTok{(df.long,}
                                     \DataTypeTok{names_from =} \StringTok{"name"}\NormalTok{,}
                                     \DataTypeTok{values_from =} \StringTok{"value"}\NormalTok{)}
\NormalTok{                         )}

\CommentTok{# wide format}
\KeywordTok{head}\NormalTok{(df.wide)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                       time WthStnPress WthStnHum WthStnRain WthStnSolRad
## 1 2018-09-30T22:00:00.000Z     1012.30      87.0        0.8            0
## 2 2018-09-30T23:00:00.000Z     1011.90      87.5        1.1            0
## 3 2018-10-01T00:00:00.000Z     1011.45      87.5        0.5            0
## 4 2018-10-01T01:00:00.000Z     1010.90      86.5        0.5            0
## 5 2018-10-01T02:00:00.000Z     1010.55      88.0        0.6            0
## 6 2018-10-01T03:00:00.000Z     1010.20      89.0        0.1            0
##   WthStnTemp WthStnWindDir WthStnWindSpd BldgEnergyHotwater BldgEnergyHeating
## 1      12.80        157.50           3.2                  0                 0
## 2      12.35         11.25           1.6                 19                 0
## 3      11.90        146.25           2.4                  0                 0
## 4      11.90        157.50           0.8                  0                 0
## 5      11.60        146.25           2.4                  0                 0
## 6      11.75         22.50           0.8                  0                 0
##   FlatVolFlowColdwater FlatVolFlowHotwater FlatHum FlatTemp
## 1                0.006                   0      NA       NA
## 2                0.000                   0      NA       NA
## 3                0.000                   0      NA       NA
## 4                0.000                   0      NA       NA
## 5                0.006                   0      NA       NA
## 6                0.000                   0      NA       NA
\end{verbatim}

\hypertarget{explorative-data-analysis}{%
\chapter{Explorative Data Analysis}\label{explorative-data-analysis}}

\hypertarget{get-overview}{%
\section{Get overview}\label{get-overview}}

\begin{quote}
Get an overview of the whole data set and specific series of it
\end{quote}

\hypertarget{load-data}{%
\subsection{Load data}\label{load-data}}

\begin{quote}
Load test data set in a data frame (e.g.~from a csv-file)
\end{quote}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"https://github.com/retomarek/r/raw/master/datasets/buildingMonitoringTestDataSet.csv"}\NormalTok{, }\DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{, }\DataTypeTok{sep =}\StringTok{","}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\hypertarget{names}{%
\subsection{Names}\label{names}}

\begin{quote}
show the column headers of the data frame
\end{quote}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{names}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "time"                 "WthStnPress"          "WthStnHum"           
##  [4] "WthStnRain"           "WthStnSolRad"         "WthStnTemp"          
##  [7] "WthStnWindDir"        "WthStnWindSpd"        "BldgEnergyHotwater"  
## [10] "BldgEnergyHeating"    "FlatHum"              "FlatTemp"            
## [13] "FlatVolFlowColdwater" "FlatVolFlowHotwater"
\end{verbatim}

\hypertarget{structure}{%
\subsection{Structure}\label{structure}}

\begin{quote}
show the structure of the data frame
\end{quote}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{str}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    16394 obs. of  14 variables:
##  $ time                : chr  "2018-09-30T22:00:00.000Z" "2018-09-30T23:00:00.000Z" "2018-10-01T00:00:00.000Z" "2018-10-01T01:00:00.000Z" ...
##  $ WthStnPress         : num  1012 1012 1011 1011 1011 ...
##  $ WthStnHum           : num  87 87.5 87.5 86.5 88 89 86.5 81 78 80.5 ...
##  $ WthStnRain          : num  0.8 1.1 0.5 0.5 0.6 0.1 0.2 0 0 0 ...
##  $ WthStnSolRad        : num  0 0 0 0 0 0 0 0 3 24.5 ...
##  $ WthStnTemp          : num  12.8 12.4 11.9 11.9 11.6 ...
##  $ WthStnWindDir       : num  157.5 11.2 146.2 157.5 146.2 ...
##  $ WthStnWindSpd       : num  3.2 1.6 2.4 0.8 2.4 0.8 0.8 3.2 4 3.2 ...
##  $ BldgEnergyHotwater  : num  0 19 0 0 0 ...
##  $ BldgEnergyHeating   : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ FlatHum             : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ FlatTemp            : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ FlatVolFlowColdwater: num  0.006 0 0 0 0.006 ...
##  $ FlatVolFlowHotwater : num  0 0 0 0 0 ...
\end{verbatim}

\hypertarget{headtail}{%
\subsection{Head/Tail}\label{headtail}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                       time WthStnPress WthStnHum WthStnRain WthStnSolRad
## 1 2018-09-30T22:00:00.000Z     1012.30      87.0        0.8            0
## 2 2018-09-30T23:00:00.000Z     1011.90      87.5        1.1            0
## 3 2018-10-01T00:00:00.000Z     1011.45      87.5        0.5            0
## 4 2018-10-01T01:00:00.000Z     1010.90      86.5        0.5            0
## 5 2018-10-01T02:00:00.000Z     1010.55      88.0        0.6            0
## 6 2018-10-01T03:00:00.000Z     1010.20      89.0        0.1            0
##   WthStnTemp WthStnWindDir WthStnWindSpd BldgEnergyHotwater BldgEnergyHeating
## 1      12.80        157.50           3.2                  0                 0
## 2      12.35         11.25           1.6                 19                 0
## 3      11.90        146.25           2.4                  0                 0
## 4      11.90        157.50           0.8                  0                 0
## 5      11.60        146.25           2.4                  0                 0
## 6      11.75         22.50           0.8                  0                 0
##   FlatHum FlatTemp FlatVolFlowColdwater FlatVolFlowHotwater
## 1      NA       NA                0.006                   0
## 2      NA       NA                0.000                   0
## 3      NA       NA                0.000                   0
## 4      NA       NA                0.000                   0
## 5      NA       NA                0.006                   0
## 6      NA       NA                0.000                   0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tail}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                           time WthStnPress WthStnHum WthStnRain WthStnSolRad
## 16389 2020-08-13T18:00:00.000Z    1011.650     74.75    2.19964            9
## 16390 2020-08-13T19:00:00.000Z    1012.000     79.00    2.19964            0
## 16391 2020-08-13T20:00:00.000Z    1011.950     78.25    2.19964            0
## 16392 2020-08-13T21:00:00.000Z    1012.025     76.50    2.19964            0
## 16393 2020-08-13T22:00:00.000Z    1012.250     73.00    0.00000            0
## 16394 2020-08-13T23:00:00.000Z          NA        NA         NA           NA
##       WthStnTemp WthStnWindDir WthStnWindSpd BldgEnergyHotwater
## 16389     22.000        162.00      0.000000                 NA
## 16390     20.175        124.25      1.609340                 NA
## 16391     19.350        125.00      0.402335                 NA
## 16392     19.900         93.00      1.609340                 NA
## 16393     20.625        116.25      2.414010                 NA
## 16394         NA            NA            NA                 NA
##       BldgEnergyHeating FlatHum FlatTemp FlatVolFlowColdwater
## 16389                NA      NA       NA                   NA
## 16390                NA      NA       NA                   NA
## 16391                NA      NA       NA                   NA
## 16392                NA      NA       NA                   NA
## 16393                NA      NA       NA                   NA
## 16394                NA      NA       NA                   NA
##       FlatVolFlowHotwater
## 16389                  NA
## 16390                  NA
## 16391                  NA
## 16392                  NA
## 16393                  NA
## 16394                  NA
\end{verbatim}

\hypertarget{five-number-summary}{%
\subsection{Five number summary}\label{five-number-summary}}

\begin{quote}
reveals details of a specific series
\end{quote}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(df}\OperatorTok{$}\NormalTok{WthStnTemp)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##   -5.25    5.50   11.25   11.99   17.35   40.30      12
\end{verbatim}

\hypertarget{data-wrangling}{%
\section{Data Wrangling}\label{data-wrangling}}

\hypertarget{season-from-date}{%
\subsection{season from date}\label{season-from-date}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# install redutils library}
\CommentTok{# devtools::install_github("retomarek/redutils", ref = "master")}

\CommentTok{# get season from a date}
\NormalTok{redutils}\OperatorTok{::}\KeywordTok{season}\NormalTok{(}\KeywordTok{as.Date}\NormalTok{(}\StringTok{"2019-04-01"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Spring"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{redutils}\OperatorTok{::}\KeywordTok{season}\NormalTok{(}\KeywordTok{as.Date}\NormalTok{(}\StringTok{"2019-04-01"}\NormalTok{), }\KeywordTok{c}\NormalTok{(}\StringTok{"Winter"}\NormalTok{,}\StringTok{"Frühling","}\NormalTok{Sommer}\StringTok{","}\NormalTok{Herbst}\StringTok{"))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Frühling"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# apply it for a data frame}
\NormalTok{df.season <-}\StringTok{ }\NormalTok{dplyr}\OperatorTok{::}\KeywordTok{mutate}\NormalTok{(df, }\DataTypeTok{season =}\NormalTok{ redutils}\OperatorTok{::}\KeywordTok{season}\NormalTok{(df}\OperatorTok{$}\NormalTok{time))}
\KeywordTok{head}\NormalTok{(df.season)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                       time WthStnPress WthStnHum WthStnRain WthStnSolRad
## 1 2018-09-30T22:00:00.000Z     1012.30      87.0        0.8            0
## 2 2018-09-30T23:00:00.000Z     1011.90      87.5        1.1            0
## 3 2018-10-01T00:00:00.000Z     1011.45      87.5        0.5            0
## 4 2018-10-01T01:00:00.000Z     1010.90      86.5        0.5            0
## 5 2018-10-01T02:00:00.000Z     1010.55      88.0        0.6            0
## 6 2018-10-01T03:00:00.000Z     1010.20      89.0        0.1            0
##   WthStnTemp WthStnWindDir WthStnWindSpd BldgEnergyHotwater BldgEnergyHeating
## 1      12.80        157.50           3.2                  0                 0
## 2      12.35         11.25           1.6                 19                 0
## 3      11.90        146.25           2.4                  0                 0
## 4      11.90        157.50           0.8                  0                 0
## 5      11.60        146.25           2.4                  0                 0
## 6      11.75         22.50           0.8                  0                 0
##   FlatHum FlatTemp FlatVolFlowColdwater FlatVolFlowHotwater season
## 1      NA       NA                0.006                   0   Fall
## 2      NA       NA                0.000                   0   Fall
## 3      NA       NA                0.000                   0   Fall
## 4      NA       NA                0.000                   0   Fall
## 5      NA       NA                0.006                   0   Fall
## 6      NA       NA                0.000                   0   Fall
\end{verbatim}

\hypertarget{data-visualizations}{%
\chapter{Data Visualizations}\label{data-visualizations}}

\hypertarget{general-plots}{%
\section{General Plots}\label{general-plots}}

\hypertarget{scatterplot}{%
\subsection{Scatterplot}\label{scatterplot}}

\hypertarget{plot}{%
\subsubsection{plot()}\label{plot}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# load data set}
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"https://github.com/retomarek/r/raw/master/datasets/buildingMonitoringTestDataSet.csv"}\NormalTok{, }\DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{, }\DataTypeTok{sep =}\StringTok{","}\NormalTok{)}

\CommentTok{# crate simple scatterplot}
\KeywordTok{plot}\NormalTok{(df}\OperatorTok{$}\NormalTok{WthStnTemp, df}\OperatorTok{$}\NormalTok{BldgEnergyHeating)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Energy-Data-Analysis-with-R_files/figure-latex/scatterplot plot-1.pdf}

\hypertarget{building-energy-signature}{%
\section{Building Energy Signature}\label{building-energy-signature}}

\hypertarget{static}{%
\subsection{static}\label{static}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(ggplot2)}
\KeywordTok{library}\NormalTok{(plotly)}
\KeywordTok{library}\NormalTok{(dplyr)}
\KeywordTok{library}\NormalTok{(redutils)}
\KeywordTok{library}\NormalTok{(lubridate)}

\CommentTok{# load data set}
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"https://github.com/retomarek/r/raw/master/datasets/buildingMonitoringTestDataSet.csv"}\NormalTok{,}
               \DataTypeTok{stringsAsFactors=}\OtherTok{FALSE}\NormalTok{, }\DataTypeTok{sep =}\StringTok{","}\NormalTok{)}

\CommentTok{# select data and calculate season}
\NormalTok{data <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{select}\NormalTok{(time, WthStnTemp, BldgEnergyHeating) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{season =}\NormalTok{ redutils}\OperatorTok{::}\KeywordTok{season}\NormalTok{(df}\OperatorTok{$}\NormalTok{time)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{na.omit}\NormalTok{()}

\CommentTok{# Aggregate data to daily values}
\NormalTok{data}\OperatorTok{$}\NormalTok{time <-}\StringTok{ }\KeywordTok{parse_date_time}\NormalTok{(data}\OperatorTok{$}\NormalTok{time, }\StringTok{"YmdHMS"}\NormalTok{, }\DataTypeTok{tz =} \StringTok{"Europe/Zurich"}\NormalTok{)}
\NormalTok{data}\OperatorTok{$}\NormalTok{year <-}\StringTok{ }\KeywordTok{as.Date}\NormalTok{(}\KeywordTok{cut}\NormalTok{(data}\OperatorTok{$}\NormalTok{time, }\DataTypeTok{breaks =} \StringTok{"year"}\NormalTok{))}
\NormalTok{data}\OperatorTok{$}\NormalTok{month <-}\StringTok{ }\KeywordTok{as.Date}\NormalTok{(}\KeywordTok{cut}\NormalTok{(data}\OperatorTok{$}\NormalTok{time, }\DataTypeTok{breaks =} \StringTok{"month"}\NormalTok{))}
\NormalTok{data}\OperatorTok{$}\NormalTok{day <-}\StringTok{ }\KeywordTok{as.Date}\NormalTok{(}\KeywordTok{cut}\NormalTok{(data}\OperatorTok{$}\NormalTok{time, }\DataTypeTok{breaks =} \StringTok{"day"}\NormalTok{))}

\NormalTok{data <-}\StringTok{ }\NormalTok{data }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{select}\NormalTok{(day, WthStnTemp, BldgEnergyHeating, season) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{group_by}\NormalTok{(day) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{WthStnTemp =} \KeywordTok{mean}\NormalTok{(WthStnTemp))}

\NormalTok{data <-}\StringTok{ }\NormalTok{data }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{group_by}\NormalTok{(day) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{BldgEnergyHeating =} \KeywordTok{sum}\NormalTok{(BldgEnergyHeating))}

\NormalTok{data <-}\StringTok{ }\NormalTok{data }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{unique}\NormalTok{()}

\CommentTok{# static chart with ggplot}
\NormalTok{p <-}\StringTok{ }\NormalTok{ggplot2}\OperatorTok{::}\KeywordTok{ggplot}\NormalTok{(data) }\OperatorTok{+}
\StringTok{  }\NormalTok{ggplot2}\OperatorTok{::}\KeywordTok{geom_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ WthStnTemp,}
                          \DataTypeTok{y =}\NormalTok{ BldgEnergyHeating, }\DataTypeTok{color=}\NormalTok{season,}
                          \DataTypeTok{text =} \KeywordTok{paste}\NormalTok{(}\StringTok{"</br>Date:  "}\NormalTok{, }\KeywordTok{as.Date}\NormalTok{(data}\OperatorTok{$}\NormalTok{day),}
                                       \StringTok{"</br>Temp: "}\NormalTok{, }\KeywordTok{round}\NormalTok{(data}\OperatorTok{$}\NormalTok{WthStnTemp, }\DataTypeTok{digits =} \DecValTok{1}\NormalTok{), }\StringTok{"\textbackslash{}u00B0C"}\NormalTok{,}
                                       \StringTok{"</br>Energy: "}\NormalTok{, }\KeywordTok{round}\NormalTok{(data}\OperatorTok{$}\NormalTok{BldgEnergyHeating, }\DataTypeTok{digits =} \DecValTok{0}\NormalTok{), }\StringTok{"kWh/d"}\NormalTok{,}
                                       \StringTok{"</br>Season: "}\NormalTok{, data}\OperatorTok{$}\NormalTok{season))}
\NormalTok{                      ) }\OperatorTok{+}
\StringTok{  }\KeywordTok{ggtitle}\NormalTok{(}\StringTok{"Building Energy Signature"}\NormalTok{) }\OperatorTok{+}
\StringTok{        }\KeywordTok{theme_minimal}\NormalTok{() }\OperatorTok{+}
\StringTok{        }\KeywordTok{theme}\NormalTok{(}
          \DataTypeTok{legend.position=}\StringTok{"none"}\NormalTok{,}
          \DataTypeTok{plot.title =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{hjust =} \FloatTok{0.5}\NormalTok{)}
\NormalTok{        )}
\NormalTok{p}
\end{Highlighting}
\end{Shaded}

\includegraphics{Energy-Data-Analysis-with-R_files/figure-latex/energysignature ggplot-1.pdf}

\hypertarget{interactive}{%
\subsection{interactive}\label{interactive}}

Make ggplot2 chart above interactive with plotly

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# continuation from upper ggplot code section}
\NormalTok{plotly}\OperatorTok{::}\KeywordTok{ggplotly}\NormalTok{(p, }\DataTypeTok{tooltip =} \KeywordTok{c}\NormalTok{(}\StringTok{"text"}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{layout}\NormalTok{(}\DataTypeTok{xaxis =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{title =} \StringTok{"Outside temperature (\textbackslash{}u00B0C)"}\NormalTok{,}
                      \DataTypeTok{range =} \KeywordTok{c}\NormalTok{(}\KeywordTok{min}\NormalTok{(}\OperatorTok{-}\DecValTok{5}\NormalTok{,}\KeywordTok{min}\NormalTok{(data}\OperatorTok{$}\NormalTok{WthStnTemp)), }\KeywordTok{max}\NormalTok{(}\DecValTok{35}\NormalTok{,}\KeywordTok{max}\NormalTok{(data}\OperatorTok{$}\NormalTok{WthStnTemp))), }\DataTypeTok{zeroline =}\NormalTok{ F),}
         \DataTypeTok{yaxis =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{title =} \StringTok{"Daily energy consumption (kWh/d)"}\NormalTok{,}
                      \DataTypeTok{range =} \KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{5}\NormalTok{, }\KeywordTok{max}\NormalTok{(data}\OperatorTok{$}\NormalTok{BldgEnergyHeating) }\OperatorTok{+}\StringTok{ }\DecValTok{10}\NormalTok{)),}
         \DataTypeTok{showlegend =} \OtherTok{TRUE}
\NormalTok{         ) }\OperatorTok{%>%}
\StringTok{  }\NormalTok{plotly}\OperatorTok{::}\KeywordTok{config}\NormalTok{(}\DataTypeTok{displayModeBar =} \OtherTok{FALSE}\NormalTok{, }\DataTypeTok{displaylogo =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Energy-Data-Analysis-with-R_files/figure-latex/energysignature plotly-1.pdf}

\hypertarget{appendix-appendix}{%
\appendix}


\hypertarget{installation}{%
\chapter{Installing R and R Studio}\label{installation}}

\begin{itemize}
\tightlist
\item
  Before we can start the first analysis, we have to install ``R'' and ``RStudio''.
\item
  ``R'' is a programming language used for statistical computing while ``RStudio'' provides a graphical user interface.
\item
  ``R'' may be used without ``RStudio'', but ``RStudio'' may not be used without ``R''. Both, ``R'' and ``RStudio'' are free of charge and there are no licencse fees.
\end{itemize}

\hypertarget{download-and-install-r}{%
\section{Download and Install R}\label{download-and-install-r}}

\hypertarget{windows}{%
\subsection{Windows}\label{windows}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Open \url{https://cran.r-project.org/bin/windows/base/} and press the link ``Download R\ldots{}''
\item
  Run the downloaded installer file and follow the installation wizard
\end{enumerate}

The wizard will install R into your ``Program Files'' folders and add a shortcut in your Start menu. Note that you will need to have all necessary administration rights to install new software on your machine.

\hypertarget{mac-osx}{%
\subsection{Mac OSX}\label{mac-osx}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Open \url{https://cran.r-project.org/bin/macosx/} and download the latest *.pkg file
\item
  Run the downloaded installer file and follow the installation wizard
\end{enumerate}

The installer allows you to customize your installation. However the default values will be suitable for most users.

\hypertarget{linux}{%
\subsection{Linux}\label{linux}}

R is part of many Linux distributions, therefore you should check with your Linux package management system if it's already installed.

The CRAN website provides files to build R from source on Debian, Redhat, SUSE, and Ubuntu systems under the link ``Download R for Linux''

\begin{itemize}
\tightlist
\item
  Open \url{https://cran.r-project.org/bin/linux/} and then follow the directory trail to the version of Linux you wish to install R on top of
\end{itemize}

The exact installation procedure will vary depending on your Linux operating system. CRAN supports the process by grouping each set of source files with documentation or README files that explain how to install on your system.

\hypertarget{download-and-install-rstudio}{%
\section{Download and Install RStudio}\label{download-and-install-rstudio}}

R Studio is a development environment for R.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Open \url{https://rstudio.com/products/rstudio/download/} and download ``RStudio Desktop Open Source''
\item
  Follow the on-screen instructions
\item
  Once you have installed R Studio, you can run it like any other application via
\end{enumerate}

\hypertarget{open-rstudio}{%
\section{Open RStudio}\label{open-rstudio}}

Now that you have both R and RStudio on your computer, you can begin using R by opening the RStudio program. Open RStudio just as you would any program, by clicking on its icon or by typing ``RStudio'' at the Windows Run prompt.

\hypertarget{packages}{%
\chapter{R Packages}\label{packages}}

Many functions of R are not pre-installed and must be loaded manually. R packages are similar to libraries in C, Python etc. An R package bundles useful functions, help files and data sets. You can use these functions within your own R code once you load the package. The following describes how to load and use packages.

\hypertarget{install-packages}{%
\section{Install Packages}\label{install-packages}}

The easiest way to install an R Package is to use the install.packages function. Open R (if already opened please close all projects) and type the following at the command line:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"ggplot2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

This will search for the package ``ggplot'' specified on a server (the so-called CRAN website). If the package exists, it will be downloaded to a library folder on your computer. Here R can access the package in future R sessions without having to reinstall it.

If you want to install a package directly from github, the package `devtools' must be installed first:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"devtools"}\NormalTok{)}
\KeywordTok{library}\NormalTok{(devtools)}
\KeywordTok{install_github}\NormalTok{(}\StringTok{"retomarek/redutils"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{loading-packages}{%
\section{Loading Packages}\label{loading-packages}}

If you have installed a package, its functions are not yet available in your R project.

To use an R package, you must load it with the following command:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"ggplot2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

  \bibliography{book.bib,packages.bib}

\end{document}
